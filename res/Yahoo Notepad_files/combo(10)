YUI.add("_shared_module_calendar_notepad_folder_menu",function(a){a.namespace("ui.Templates");a.ui.Templates._shared_module_calendar_notepad_folder_menu={base:'<div data-id="menu-calendar-list" class="optionMenu"> <ul class="first"> {{listItems}} </ul></div>',listItems:'<li data-action="select-folder-move" data-fid="{{folderId}}"><a href="#">{{folderName}}</a></li> '};},"1.0.0");YUI.add("calendar-notepad-listMoveMenu-view",function(d){var b=d.lib.Utils,a=[];var c=function(e){var g=this,f={data:{value:null},rootNode:{writeOnce:true},template:{value:d.ui.Templates._shared_module_calendar_notepad_folder_menu}};d.augment(g,d.Attribute);g.addAttrs(f,e||{});d.augment(g,d.EventTarget);};c.prototype={formatters:{listItems:function(l,f,j){var m=this,e=[],h=f.folders,k={},g;for(g=0;g<h.length;g++){k={folderName:b.escapeHtml(h[g].get("name")),folderId:h[g].get("id")};e.push(b.substitute(j.get("template").listItems,k,null,null,strings));}return e.join("");}},render:function(){var e=this;e.set("rootNode",d.Node.create(b.substitute(e.get("template").base,{},e.formatters,e.get("data"),strings,null,e)));e.get("rootNode").generateID();d.one("body").appendChild(e.get("rootNode"));},syncUI:function(){var e=this;e.get("rootNode").one("ul").replace(d.Node.create(b.substitute(e.get("template").base,{},e.formatters,e.get("data"),strings,null,e)).one("ul"));},close:function(){var e=this;e.get("rootNode").remove(true);}};d.namespace("calendar.notepad.listMoveMenu");d.calendar.notepad.listMoveMenu.view=c;},"1.0.0",{requires:["node-base","node-event-delegate","attribute-base","event-base","lib-utils","_shared_module_calendar_notepad_folder_menu","lib-utils-menu"]});YUI.add("calendar-notepad-listMoveMenu-controller",function(c){var a=c.calendar.model.dataModel;var b=function(d){var f=this,e={rootNode:{value:null},widget:{setter:function(g){g.render();}}};c.augment(f,c.Attribute);c.augment(f,c.EventTarget);f.evt=[];f.addAttrs(e,d||{});f.process();};b.prototype={process:function(){var j=this,h={},e,g,d,f={isReadOnly:false,url:null};f.type="JOURNAL";h.folders=a.getFolders(f).sort(function(l,k){var i=l.get("name").toLowerCase(),m=k.get("name").toLowerCase();return((i<m)?-1:((i>m)?1:0));});j.set("widget",new c.calendar.notepad.listMoveMenu.view({data:h}));j.set("rootNode",j.get("widget").get("rootNode"));for(e in j.evt){c.detach(j.evt[e]);}j.evt=[];j.evt.push(a.on("datamodel:foldersUpdated",function(){j.updateFolders("JOURNAL");},j));j.evt.push(j.on("menu:selected",j.handleAction,j));},handleAction:function(d){var f=this;if(!d.details[0]){return;}f.fire("menu:move",d.details[0].getAttribute("data-fid"));},updateFolders:function(d){var f=this,e=f.get("widget").get("data");e.folders=a.getFolders({type:d}).sort(function(i,h){var g=i.get("name").toLowerCase(),j=h.get("name").toLowerCase();return((g<j)?-1:((g>j)?1:0));});f.get("widget").syncUI();},close:function(){var e=this,d;for(d in e.evt){c.detach(e.evt[d]);}e.evt=[];e.get("widget").close();}};c.namespace("calendar.notepad.listMoveMenu");c.calendar.notepad.listMoveMenu.controller=b;},"1.0.0",{requires:["event-base","calendar-notepad-listMoveMenu-view","calendar-model-datamodel"]});YUI.add("calendar-notepad-toolbar-controller",function(f){var a=[],b=f.calendar.model.dataModel,d=f.lib.Utils,c=f.lib.utils.Stats.ultTracker;var e=function(g){var i=this,h={rootNode:{writeOnce:true,setter:function(){i.get("widget")&&i.get("widget").render();}},widget:{setter:function(j){i.get("rootNode")&&j.render();}},currentMode:{value:null}};f.augment(i,f.Attribute);i.addAttrs(h,g||{});f.augment(i,f.EventTarget);};e.prototype={process:function(){var k=this,h=[],g,j=new f.calendar.notepad.listMoveMenu.controller();k.set("widget",new f.calendar.notepad.toolbar.view({rootNode:k.get("rootNode"),menu:j}));for(g in a){f.detach(a[g]);}a=[];a.push(b.on("datamodel:noteChange",k.syncUI,k));a.push(b.on("datamodel:noteFolderChange",k.syncUI,k));a.push(j.on("menu:move",k.handleMenuAction,k));a.push(k.get("widget").on("view:delete",k.deleteNote,k));a.push(k.on("hide",k.get("widget").hide,k.get("widget")));a.push(k.on("show",k.get("widget").show,k.get("widget")));a.push(k.on("close",k.close));},syncUI:function(h){var i=this,g=(h.details[0].type==="note");if(g){(!b.get("selectedNote")||(b.get("selectedNote")==="new-note"))&&(g=false);}i.get("widget").syncUI(g);},deleteNote:function(i){var j=this,g=b.get("selectedNote"),h;if(!g){return;}h=new f.calendar.dialogs.confirmDelete.controller({dlgType:4});h.execute(function(k){if(k.check){f.lib.utils.Stats.stampPage("1350750005");b.deleteNote({uid:g});}});},handleMenuAction:function(j){var l=this,g=j.details[0],h=b.getNotes({uid:b.get("selectedNote")}),k=b.get("noteActiveEdit"),i;if(k){i=new f.calendar.dialogs.saveChanges.controller();i.execute(strings.str_cal_np_save_changes,function(m){if(m.details[0].focus){return;}else{if(m.details[0].saveChanges){l.updateNote(g,h,f.one("input#note-title-edit").get("value"),f.one("textarea#note-body-edit").get("value"));}else{l.updateNote(g,h,h.get("summary"),h.get("description"));}}});}else{l.updateNote(g,h,h.get("summary"),h.get("description"));}},updateNote:function(g,i,h,j){var k=this;if(g&&i){b.updateNote({uid:i.get("uid"),summary:h,description:j,fid:g});}},close:function(){var h=this,g;for(g in a){f.detach(a[g]);}a=[];h.menu.close();h.get("widget").close();}};f.namespace("calendar.notepad.toolbar");f.calendar.notepad.toolbar.controller=e;},"1.0.0",{requires:["event-base","lib-utils-stats","calendar-notepad-toolbar-view","calendar-model-datamodel","calendar-notepad-listMoveMenu-controller","calendar-dialogs-saveChanges-controller","calendar-dialogs-confirmDelete-controller"]});YUI.add("_shared_module_calendar_notepad_notes_layout",function(a){a.namespace("ui.Templates");a.ui.Templates._shared_module_calendar_notepad_notes_layout={base:'<div id="subshellnavigation"> <div id="msg-list" class="unselectable ml ml-notepad content"> <div id="notepad-list" class="list-view-container list-view-items-inner"> {{noteListItem}} </div> </div></div>{{noteEditPage}}{{welcome_page}}{{zero_notes}}',noteListItem:'<div tabindex="-1" class="list-view-item draggable" role="option" data-action="select-note" data-uid="{{noteUid}}"> <div class="flex" role="presentation"> <div class="note-name">{{noteSummary}}</div> <div class="note-details"> <span class="note-description">{{noteDescription}}</span> <div class="action-toolbar"> <a class="icon icon-small-delete delete-msg" data-action="delete" title="{{str_cal_np_delete_note_tooltip}}"></a> </div> </div> </div> </div> ',noteEditPage:'<div id="noteEditPage"> <div class="edit-note-header"> <input id="note-title-edit" value="{{noteSummary}}"></input> </div> <div class="edit-note-body"> <textarea id="note-body-edit">{{noteDescription}}</textarea> </div> <div class="edit-note-footer"> <span class="btn default" data-action="save-note" role="button"> <a href="#" title="{{str_cal_np_save_this_note}}">{{str_cal_np_save}}</a> </span> <span class="btn" data-action="cancel" role="button"> <a href="#" title="{{str_cal_np_cancel}}">{{str_cal_np_cancel}}</a> </span> </div> </div>',welcomeMessage:'<span class="welcome-message"> {{str_cal_np_landing_page}} </span> ',searchPage:'<span class="search-message"> {{message}} </span> ',welcome_page:'<div id="welcome-notepad"> {{welcomeMessage}} {{searchPage}}</div>',zero_notes:'<div id="zero-notes">{{msg}}</div>'};},"1.0.0");YUI.add("calendar-notepad-notesNavigator-view",function(c){var d=c.lib.Utils,g=d.Menu,h=c.lib.utils.Stats.ultTracker,f=c.calendar.model.dataModel,a=null,j=null,e=null,i=[];var b=function(k){var m=this,l={data:{value:null},rootNode:{writeOnce:true},template:{value:c.ui.Templates._shared_module_calendar_notepad_notes_layout},noteChanges:{value:false},currentSelectedNote:{value:null},currentMode:{value:null},currentFolder:{value:null}};c.augment(m,c.Attribute);m.addAttrs(l,k||{});c.augment(m,c.EventTarget);};b.prototype={formatters:{noteListItem:function(q,m,o){var r=o,k="",n,p=false,l;for(l in m.notes){if(m.notes[l]!==undefined){p=true;break;}}if((m.notes.length>0)&&p){for(n in m.notes){k=k+d.substitute(o.get("template").noteListItem,{noteSummary:m.notes[n].get("summary"),noteUid:m.notes[n].get("uid"),noteDescription:m.notes[n].get("description").slice(0,100)},null,null,strings,null,r);}}else{if(r.get("currentFolder")!=="search"){k=d.substitute(o.get("template").zero_notes,{msg:strings.str_cal_np_zero_notes},null,null,strings,null,r);}else{k=d.substitute(o.get("template").zero_notes,{msg:strings.str_cal_np_zero_notes_search},null,null,strings,null,r);}}return k;},welcome_page:function(m,k,l){var n=l;return d.substitute(l.get("template").welcome_page,{},n.formatters,k,strings,null,n);},searchPage:function(n,k,l){var o=l,m;if(o.get("currentFolder")!=="search"){return"";}if(k.notes.length>0){m=d.substitute(strings.str_cal_np_search_results_message,{number:k.notes.length},null,null,strings,null,o);}else{m=strings.str_cal_np_search_results_message_none;}return d.substitute(l.get("template").searchPage,{message:m},null,null,strings,null,o);},welcomeMessage:function(m,k,l){var n=l;if(n.get("currentFolder")==="search"){return"";}return d.substitute(l.get("template").welcomeMessage,{},null,null,strings,null,n);}},render:function(){var p=this,k,n=p.get("rootNode").one("#subshellnavigation"),o=p.get("rootNode").one("#noteEditPage"),m=p.get("currentSelectedNote"),l;k=c.Node.create(d.substitute(p.get("template").base,{},p.formatters,p.get("data"),strings,null,p));p.get("rootNode").empty();p.get("rootNode").appendChild(k);if(m){l=p.get("rootNode").one('.list-view-item[data-uid="'+m.get("uid")+'"]');if(l){l.addClass("selected");p.clickNote({target:l,type:"simulated"});}else{p.set("currentSelectedNote",null);p.fire("view:noteSelected",null);}}p.syncUI();p.bindUI();},syncUI:function(){var k=this;},bindUI:function(){var o=this,m,k,n,l;for(l in i){c.detach(i[l]);}i=[];i.push(o.get("rootNode").on("click",function(r){var s=this,p,q;p=r.target.ancestor("a.icon.icon-small-delete.delete-msg",true)||r.target.ancestor("div.list-view-item",true)||r.target.ancestor("span.btn",true)||r.target;q=p.getAttribute("data-action");switch(q){case"select-note":s.clickNote(r);r.halt();break;case"save-note":s.saveNote();break;case"delete":s.deleteNote(r);break;case"cancel":s.cancelEdit(r);break;}},o));i.push(o.get("rootNode").delegate("keydown",function(r){var s=this,p,q;s.set("noteChanges",true);},"#note-body-edit,#note-title-edit",o));i.push(o.get("rootNode").delegate("mouseenter",function(r){var s=this,q=r.target.ancestor("div.list-view-item",true),p;if(q){p=q.one(".action-toolbar");p.setStyle("display","block");}},"div.list-view-item",o));i.push(o.get("rootNode").delegate("mouseleave",function(r){var s=this,q=r.target.ancestor("div.list-view-item",true),p;if(q){p=q.one(".action-toolbar");p.setStyle("display","none");}},"div.list-view-item",o));},clickNote:function(r){var p=this,k=r.target.ancestor("div.list-view-item",true),q=k.getAttribute("data-uid"),u,o,n=p.get("data"),v,m,l=p.get("noteChanges"),t=r.type,s;for(o in n.notes){if(n.notes[o].get("uid")===q){u=n.notes[o];}}if(u){if((t!=="simulated")){c.lib.utils.Stats.stampPage("1350750011");}if((t!=="simulated")&&l){s=new c.calendar.dialogs.saveChanges.controller();s.execute(strings.str_cal_np_save_changes,function(x){var w=p.get("currentSelectedNote");if(x.details[0].focus){return;}else{if(x.details[0].saveChanges){p.set("currentSelectedNote",u);f.updateNote({uid:w.get("uid"),summary:c.one("input#note-title-edit").get("value"),description:c.one("textarea#note-body-edit").get("value")},{success:function(){},failure:function(){p.set("currentSelectedNote",w);}});}else{p.noteClicked(q,u,k,m);}}});}else{p.noteClicked(q,u,k,m);}}},noteClicked:function(l,n,m,o){var p=this,k;p.fire("view:noteSelected",l);p.set("currentSelectedNote",n);p.get("rootNode").all("div.list-view-item").removeClass("selected");m.addClass("selected");if((o=p.get("rootNode").one("#noteEditPage"))||(o=p.get("rootNode").one("#welcome-notepad"))){o.remove(true);}k=c.Node.create(d.substitute(p.get("template").noteEditPage,{noteSummary:n.get("summary"),noteDescription:n.get("description")},p.formatters,null,strings,null,p));p.get("rootNode").appendChild(k);p.set("noteChanges",false);},saveNote:function(){var o=this,l=(o.get("currentMode")==="newNote"),m=(!l)?o.get("currentSelectedNote").get("uid"):null,n=o.get("rootNode").one("textarea#note-body-edit").get("value"),k=o.get("rootNode").one("input#note-title-edit").get("value");if(o.get("currentMode")==="newNote"){o.fire("view:addNote",{folderId:o.get("currentFolder"),summary:k,description:n});}else{o.fire("view:saveNote",{uid:m,summary:k,description:n});}},deleteNote:function(n){var p=this,m=n.target.ancestor("div.list-view-item",true),l=m.getAttribute("data-uid"),o=p.get("noteChanges"),k;if(o){k=new c.calendar.dialogs.saveChanges.controller();k.execute(strings.str_cal_np_save_changes,function(r){var q=p.get("currentSelectedNote");if(r.details[0].focus){return;}else{if(r.details[0].saveChanges){f.updateNote({uid:q.get("uid"),summary:c.one("input#note-title-edit").get("value"),description:c.one("textarea#note-body-edit").get("value")},{success:function(){p.fire("view:deleteNote",{uid:l});},failure:function(){}});}else{p.fire("view:deleteNote",{uid:l});}}});}else{p.fire("view:deleteNote",{uid:l});}},newNote:function(){_this=this;if(oldNode=_this.get("rootNode").one("#noteEditPage")||(oldNode=_this.get("rootNode").one("#welcome-notepad"))){oldNode.remove(true);}newNode=c.Node.create(d.substitute(_this.get("template").noteEditPage,{noteSummary:strings.str_cal_np_new_note,noteDescription:""},_this.formatters,null,strings,null,_this));_this.get("rootNode").appendChild(newNode);_this.get("rootNode").one("input#note-title-edit").select();_this.set("noteChanges",false);_this.set("currentSelectedNote",new c.calendar.notepad.model.Note({uid:"new-note"}));_this.fire("view:noteSelected","new-note");},cancelEdit:function(l){var n=this,m=n.get("noteChanges"),k;if(m){k=new c.calendar.dialogs.saveChanges.controller();k.execute(strings.str_cal_np_save_changes,function(p){var o=n.get("currentSelectedNote");if(p.details[0].focus){return;}else{if(p.details[0].saveChanges){n.set("currentSelectedNote",null);f.updateNote({uid:o.get("uid"),summary:c.one("input#note-title-edit").get("value"),description:c.one("textarea#note-body-edit").get("value")},{success:function(){},failure:function(){n.set("currentSelectedNote",o);}});}else{n.set("currentSelectedNote",null);n.fire("view:noteSelected",null,true);}}});}else{n.set("currentSelectedNote",null);n.fire("view:noteSelected",null,true);}},hide:function(k){},show:function(k){},close:function(l){var m=this,k;for(k in i){c.detach(i[k]);}i=[];if(m.get("rootNode").one("#subshellnavigation")){m.get("rootNode").one("#subshellnavigation").remove(true);}}};c.namespace("calendar.notepad.notesNavigator");c.calendar.notepad.notesNavigator.view=b;},"1.0.0",{requires:["node","node-event-delegate","attribute-base","event-base","_shared_module_calendar_notepad_notes_layout","calendar-dialogs-saveChanges-controller"]});YUI.add("calendar-notepad-notesNavigator-controller",function(e){var a=[],b=e.calendar.model.dataModel,c=e.lib.utils.Stats.ultTracker;var d=function(f){var h=this,g={rootNode:{writeOnce:true},widget:{value:null}};e.augment(h,e.Attribute);h.addAttrs(g,f||{});e.augment(h,e.EventTarget);};d.prototype={process:function(){var h=this,g=[],f;h.set("widget",new e.calendar.notepad.notesNavigator.view({rootNode:h.get("rootNode")}));for(f in a){e.detach(a[f]);}a=[];a.push(b.on("datamodel:noteFolderChange",h.updateState,h));a.push(b.on("datamodel:searchNotesAvailable",h.updateState,h));a.push(e.on("leftPane:addNote",h.newNoteUI,h));a.push(b.on("datamodel:notesAvailable",h.updateState,h));a.push(h.get("widget").on("view:noteSelected",h.noteSelected,h));a.push(h.get("widget").on("view:saveNote",h.saveNote,h));a.push(h.get("widget").on("view:addNote",h.addNote,h));a.push(h.get("widget").on("view:deleteNote",h.deleteNote,h));a.push(h.on("hide",h.get("widget").hide,h.get("widget")));a.push(h.on("show",h.get("widget").show,h.get("widget")));a.push(h.on("close",h.close));a.push(h.get("widget").after("noteChangesChange",h.noteChanges,h));},updateState:function(h){var i=this,g={},f=b.get("selectedNoteFolder");g.notes=b.getNotes({fid:f});if(h.details[0]&&h.details[0].type&&(h.details[0].type==="folder")){i.get("widget").set("currentSelectedNote",null);b.set("selectedNote",null);}if(g.notes){b.set("noteActiveEdit",false);i.get("widget").set("noteChanges",false);i.get("widget").set("currentFolder",f);i.set("currentSelectedNote",null);i.get("widget").set("currentMode",null);i.get("widget").set("data",g);i.get("widget").render();}},noteChanges:function(f){var g=this;b.set("noteActiveEdit",g.get("widget").get("noteChanges"));},newNoteUI:function(){var h=this,g=h.get("widget").get("noteChanges"),f;if(g){f=new e.calendar.dialogs.saveChanges.controller();f.execute(strings.str_cal_np_save_changes,function(j){var i=h.get("widget").get("currentSelectedNote");if(j.details[0].focus){return;}else{if(j.details[0].saveChanges){b.updateNote({uid:i.get("uid"),summary:e.one("input#note-title-edit").get("value"),description:e.one("textarea#note-body-edit").get("value")},{success:function(){h.newNoteTrigger();},failure:function(){}});}else{h.newNoteTrigger();}}});}else{h.newNoteTrigger();}},newNoteTrigger:function(){var f=this;f.get("widget").set("currentFolder",b.get("selectedNoteFolder"));f.get("widget").set("currentMode","newNote");f.get("widget").newNote();},addNote:function(f){var g=this;b.addNote({folderId:f.details[0].folderId,summary:f.details[0].summary,description:f.details[0].description},{success:function(h){g.get("widget").set("currentSelectedNote",h);},failure:function(){}});},noteSelected:function(g){var h=this,f=g.details[0];b.set("selectedNote",f);if(g.details[1]){h.updateState(g);}},saveNote:function(f){var g=this;b.updateNote({uid:f.details[0].uid,summary:f.details[0].summary,description:f.details[0].description});},deleteNote:function(h){var i=this,g,f=h.details[0].uid;g=new e.calendar.dialogs.confirmDelete.controller({dlgType:4});g.execute(function(j){if(j.check){e.lib.utils.Stats.stampPage("1350750005");b.deleteNote({uid:f});}});},close:function(){var g=this,f;for(f in a){e.detach(a[f]);}a=[];g.get("widget").close();}};e.namespace("calendar.notesNavigator.toolbar");e.calendar.notepad.notesNavigator.controller=d;},"1.0.0",{requires:["event-base","lib-utils-stats","calendar-notepad-notesNavigator-view","calendar-model-datamodel","calendar-dialogs-confirmDelete-controller"]});YUI.add("perspective-notepad",function(b){var a=function(c){var h=this,e=b.calendar.shell.get("panelMgr"),g,f=function(){var i;i=b.one("#shellnavigation");if(i){g=h.addPanel("panel.notepadFolderList",{rootNode:i});g.addModule("notepadFolderList",g.getModule("notepadFolderList")||new b.calendar.notepad.folderNavigation.controller(c));}i=b.one("#toolbar");if(i){g=h.addPanel("panel.notepadToolbar",{rootNode:i});g.addModule("notepadToolbar",g.getModule("notepadToolbar")||new b.calendar.notepad.toolbar.controller(c));}i=b.one("#shellcontent");if(i){g=h.addPanel("panel.notepadNotesNavigator",{rootNode:i});g.addModule("notepadNotesNavigator",g.getModule("notepadNotesNavigator")||new b.calendar.notepad.notesNavigator.controller(c));}},d=function(){};b.mix(h,{load:f,unload:d});};b.namespace("perspective");b.perspective.notepad=a;},"1.0.0",{requires:["event-base","calendar-notepad-folderNavigation-controller","calendar-notepad-toolbar-controller","calendar-notepad-notesNavigator-controller"]});