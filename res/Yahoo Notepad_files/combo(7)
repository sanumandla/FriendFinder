/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("arraylist-add",function(e,t){e.mix(e.ArrayList.prototype,{add:function(t,n){var r=this._items;return e.Lang.isNumber(n)?r.splice(n,0,t):r.push(t),this},remove:function(e,t,n){n=n||this.itemsAreEqual;for(var r=this._items.length-1;r>=0;--r)if(n.call(this,e,this.item(r))){this._items.splice(r,1);if(!t)break}return this},itemsAreEqual:function(e,t){return e===t}})},"3.11.0",{requires:["arraylist"]});
/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("arraylist-filter",function(e,t){e.mix(e.ArrayList.prototype,{filter:function(t){var n=[];return e.Array.each(this._items,function(e,r){e=this.item(r),t(e)&&n.push(e)},this),new this.constructor(n)}})},"3.11.0",{requires:["arraylist"]});
/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("array-invoke",function(e,t){e.Array.invoke=function(t,n){var r=e.Array(arguments,2,!0),i=e.Lang.isFunction,s=[];return e.Array.each(e.Array(t),function(e,t){e&&i(e[n])&&(s[t]=e[n].apply(e,r))}),s}},"3.11.0",{requires:["yui-base"]});
YUI.add("common-net-session",function netSession(c){c.namespace("common.net");var e=c.Lang,z=c.common.Utils,B=c.common.net,t=B.Status={},g=0,A=c.config.win||window,b=typeof XMLHttpRequest!=="undefined",I=(c.config&&c.config.net)?c.config.net.XMLHttpRequest:window.XMLHttpRequest,v,E="GET",n,l=[],m="net:exc",G="net:start",s="net:complete",F="net:abort",H="net:end",i="net:idle",D=0;if(!netSession.reqSeq){netSession.reqSeq=0;}function C(K){try{c.fire.apply(c,K);}catch(J){z.assert(0);c.use("common-utils-error",function(){z.error.report("netsession error",J,1,1);});}}function o(){return new Date().getTime();}function h(){try{return b?new I:new ActiveXObject("Microsoft.XMLHTTP");}catch(J){c.log("CreateXhr exc"+J);}return;}function q(J){if(J._timeoutid){A.clearTimeout(J._timeoutid);J._timeoutid=v;}}function u(J){try{var K=J._conn;if(K&&b){K.onreadystatechange=v;}}catch(L){c.log("_releaseConn exc : "+L);}J._conn=v;}function k(J,M,L){var N,K=J.match(/\?([\w\W])*/);K=K&&K[0]?(K[0].length>1?"&":""):"?";N=x(M,L);return[J,N.length?K:"",N].join("");}function x(M,N){var S,R,O,Q,J,P,K=[],L=w(M,N);for(S in M){P=L[S];J=P?encodeURIComponent(S):S;R=M[S];if(e.isArray(R)){for(O=0,Q=R.length;O<Q;O++){K.push([J,P?encodeURIComponent(R[O]):R[O]].join("="));}}else{K.push([J,P?encodeURIComponent(M[S]):M[S]].join("="));}}return K.join("&");}function w(M,L){if(e.isObject(L)){return L;}var K={},J;if(L!==false){for(J in M){K[J]=1;}}return K;}function r(M){if(e.isString(M)){var L=this.responseHeaders,K=M.toLowerCase(),J;for(J in L){if(J.toLowerCase()==K){return L[J];}}}return v;}function j(U){function O(Y,W){var Z=W;try{Z=L[Y];}catch(X){c.log(X);}return Z;}var N,V={},P=0,S,J,L=U._conn,M=L.status==1223,K,R,Q;try{N={status:M?204:L.status,statusText:M?"No Content":O("statusText",""),callback:U._callback,request:U.request,responseHeaders:"",allHeadersText:"",getResponseHeader:r,responseText:O("responseText"),responseXML:O("responseXML"),id:U.id};K=L.getAllResponseHeaders();Q=K.split("\n");S=Q.length;while(S--){R=Q[P++];J=R.indexOf(":");if(J!=-1){V[R.substring(0,J)]=R.substring(J+2);}}N.responseHeaders=V;N.allHeadersText=K;}catch(T){c.log("_createRespObj exc "+T);}return N;}function d(R,J,O){var N,L=R._conn,M,K="unknown",Q=O&&(O.name==m)&&O.code,P=-1;try{if(J){M=J.timeout?t.timeout:t.abort;K="abort";}else{if(L){P=L.readyState;}if(P<=3){M=Q;K="readyState."+P;}else{N=j(R);}}}catch(Q){c.log("_createExcObj exc");c.log(Q);}if(!N){N={status:M||t.xhr,statusText:K,responseText:(O&&O.message)||v,callback:R._callback,request:R.request,getResponseHeader:r,id:R.id};}return N;}function p(J){z.assert(J._conn.readyState);if(J._conn.readyState===4){q(J);J.end=o();C([s,J,J._callback]);f(J);}}function a(K,M,O){function L(){C([H,K,M]);u(K);M=v;D--;if(!D){C([i,1]);}}var J=K._callback||{},N=O?J.success:J.failure;N?N.call(J.scope,K,M,L):L();}function f(J,N){var L=0,K,P,M=J._conn;try{L=(M&&M.status)||0;}catch(O){z.assert(0);}P=!N&&(L>=200&&L<300||L==1223);K=P?j(J):d(J,N);a(J,K,P);}B.Session=function(K,Q,J,N,M,P){var O=this,L;J=J?J.toUpperCase():E;L=J==E;O.request={url:K,urlparams:(L?N||{}:{}),post:(!L?N:v),mthd:J,enc:w(N,M),headers:{}};O._callback=Q;if(!P&&P!==0){O.id=g;}else{O.id=P;}++g;};var y=B.Session;y.formatQueryParams=x;y.genReqID=function(){var K,J;netSession.reqSeq++;K=netSession.reqSeq.toString(16);J=4-K.length;while(J--){K="0"+K;}return Config.uuid?Config.uuid.replace("SEQN",K):"";};y.suspendRequests=function(J){n=J;};y.resumeRequests=function(){n=v;while(l.length){l[0].send();l.splice(0,1);}};y.isIdle=function(){return D==0;};y.prototype={_callback:{},_conn:v,tries:0,_timeoutid:v,start:0,end:0,addUrlParam:function(J,M,L){var K=this.request,N=K.urlparams;N[J]=M;if(L!==false){K.enc[J]=1;}},send:function(){var M=this,L=M.request,R=M._callback||{},P=L.mthd,J=L.url,S,Q,O,K;if(n){l.push(M);return;}M.abort();try{M.tries++;J=k(J,L.urlparams,L.enc);if(!R.cache&&J.indexOf("&r=")==-1){J+=((J.indexOf("?")==-1)?"?":"&")+"r="+(L.rand=(new Date()).getTime());}if(J.length>=2048){throw {name:m,code:t.maxsize};}M._conn=h();S=M._conn;Q=L.post;L.postdata=Q=e.isFunction(Q)?Q():Q;S.open(P,J,true);M.applyHeaders();S.onreadystatechange=function(){if(M._conn){p(M);}};O=R.timeout;if(O){M._timeoutid=A.setTimeout(function(){M.abort(true);},O);}M.end=0;M.start=o();C([G,M,R,J]);S.send(Q||"");if(!D){C([i,0]);}D++;}catch(N){c.log("send exc "+M.id+N);K=d(M,v,N);A.setTimeout(function(){a(M,K);},0);}},setHeader:function(J,K){this.request.headers[J]=K;},getHeaders:function(){var J=[],L,K=this.request.headers;for(L in K){J.push([L,K[L]].join("="));}return J.join(";");},applyHeaders:function(){var M,L=this,J=L._conn,K=L.request.headers;if(J){z.assert(!z.isEmpty(K));for(M in K){J.setRequestHeader(M,K[M]);}if(c.config&&c.config.net){J.setRequestHeader("Cookie",c.config.net.cookie);}}},abort:function(J){var L,K=this._conn;if(K){L=this;if(K.readyState!==4&&K.readyState!==0){c.log("abort called "+this.id);q(L);u(L);K.abort();C([F,L,L._callback,J]);f(L,{timeout:J});}}}};c.mix(t,{timeout:-1,xhr:-2,maxsize:-3,abort:-4});},"1.0.0",{requires:["event-custom","common-utils"]});/*
YUI 3.11.0 (build d549e5c)
Copyright 2013 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("cookie",function(e,t){function h(e){throw new TypeError(e)}function p(e){(!s(e)||e==="")&&h("Cookie name must be a non-empty string.")}function d(e){(!s(e)||e==="")&&h("Subcookie name must be a non-empty string.")}var n=e.Lang,r=e.Object,i=null,s=n.isString,o=n.isObject,u=n.isUndefined,a=n.isFunction,f=encodeURIComponent,l=decodeURIComponent,c=e.config.doc;e.Cookie={_createCookieString:function(e,t,n,r){r=r||{};var i=f(e)+"="+(n?f(t):t),u=r.expires,a=r.path,l=r.domain;return o(r)&&(u instanceof Date&&(i+="; expires="+u.toUTCString()),s(a)&&a!==""&&(i+="; path="+a),s(l)&&l!==""&&(i+="; domain="+l),r.secure===!0&&(i+="; secure")),i},_createCookieHashString:function(e){o(e)||h("Cookie._createCookieHashString(): Argument must be an object.");var t=[];return r.each(e,function(e,n){!a(e)&&!u(e)&&t.push(f(n)+"="+f(String(e)))}),t.join("&")},_parseCookieHash:function(e){var t=e.split("&"),n=i,r={};if(e.length)for(var s=0,o=t.length;s<o;s++)n=t[s].split("="),r[l(n[0])]=l(n[1]);return r},_parseCookieString:function(e,t,n){var r={};if(s(e)&&e.length>0){var o=t===!1?function(e){return e}:l,a=e.split(/;\s/g),f=i,c=i,h=i;for(var p=0,d=a.length;p<d;p++){h=a[p].match(/([^=]+)=/i);if(h instanceof Array)try{f=l(h[1]),c=o(a[p].substring(h[1].length+1))}catch(v){}else f=l(a[p]),c="";!u(n)&&n.reverseCookieLoading?u(r[f])&&(r[f]=c):r[f]=c}}return r},_setDoc:function(e){c=e},exists:function(e){p(e);var t=this._parseCookieString(c.cookie,!0);return t.hasOwnProperty(e)},get:function(e,t){p(e);var n,r,s;return a(t)?(s=t,t={}):o(t)?s=t.converter:t={},n=this._parseCookieString(c.cookie,!t.raw,t),r=n[e],u(r)?i:a(s)?s(r):r},getSub:function(e,t,n,r){var s=this.getSubs(e,r);return s!==i?(d(t),u(s[t])?i:a(n)?n(s[t]):s[t]):i},getSubs:function(e,t){p(e);var n=this._parseCookieString(c.cookie,!1,t);return s(n[e])?this._parseCookieHash(n[e]):i},remove:function(t,n){return p(t),n=e.merge(n||{},{expires:new Date(0)}),this.set(t,"",n)},removeSub:function(e,t,n){p(e),d(t),n=n||{};var r=this.getSubs(e);if(o(r)&&r.hasOwnProperty(t)){delete r[t];if(!n.removeIfEmpty)return this.setSubs(e,r,n);for(var i in r)if(r.hasOwnProperty(i)&&!a(r[i])&&!u(r[i]))return this.setSubs(e,r,n);return this.remove(e,n)}return""},set:function(e,t,n){p(e),u(t)&&h("Cookie.set(): Value cannot be undefined."),n=n||{};var r=this._createCookieString(e,t,!n.raw,n);return c.cookie=r,r},setSub:function(e,t,n,r){p(e),d(t),u(n)&&h("Cookie.setSub(): Subcookie value cannot be undefined.");var i=this.getSubs(e);return o(i)||(i={}),i[t]=n,this.setSubs(e,i,r)},setSubs:function(e,t,n){p(e),o(t)||h("Cookie.setSubs(): Cookie value must be an object.");var r=this._createCookieString(e,this._createCookieHashString(t),!1,n);return c.cookie=r,r}}},"3.11.0",{requires:["yui-base"]});
YUI.add("common-persist-neo-data",function(b){var a=b.namespace("common.persist");function c(d){var e={cookieDomain:{writeOnce:true},cookiePath:{writeOnce:true},cookieID:{writeOnce:true},servername:{writeOnce:true},farm:{writeOnce:true},wssid:{writeOnce:true},neoguid:{writeOnce:true},hasAds:{writeOnce:true},om:{writeOnce:true},global_url_base:{writeOnce:true},extraURLArgs:{writeOnce:true},mailnetQueue:{writeOnce:true}};this.addAttrs(e,d);}b.augment(c,b.Attribute);a.NeoData=new c(window.NeoConfig);},"1.0.0",{requires:["attribute"]});YUI.add("common-persist-cookie-data",function(f){var e=f.namespace("common.persist");var g=e.NeoData;e.Cookies=[];var d="YM.NEO_"+g.get("cookieID");function b(h){h=h||d;if(e.Cookies[h]){return e.Cookies[h];}e.Cookies[h]=new a(h);return e.Cookies[h];}function c(h){h=h||d;f.Cookie.remove(h,{domain:g.get("cookieDomain"),path:g.get("cookiePath")});if(e.Cookies[h]){delete e.Cookies[h];}}function a(h){this.name=h;if(f.Cookie.get(this.name)===null){if(this.name!="T"&&this.name!="Y"){f.Cookie.set(this.name,"",this.getCookieArgs());}}else{var i=g.get("cookiePath");if(i&&i.length>2&&i[i.length-1]=="/"){i=i.slice(0,i.length-1);f.Cookie.remove(h,{domain:g.get("cookieDomain"),path:i});}}}a.prototype.getCookieArgs=function(){return{expires:new Date((new Date()).getTime()+(90*24*60*60*1000)),domain:g.get("cookieDomain"),path:g.get("cookiePath")};};a.prototype.set=function(h,i){return f.Cookie.setSub(this.name,h,i,this.getCookieArgs());};a.prototype.get=function(h){return f.Cookie.getSub(this.name,h,this.getCookieArgs());};a.prototype.remove=function(h){return f.Cookie.removeSub(this.name,h);};f.augment(a,f.Attribute);e.getCookie=b;e.removeCookie=c;if(NeoConfig.intl==="jp"){f.use("common-persist-cookie-data-jp",function(h){e.Cookie=e.CookieJp;e.getCookie=e.getCookieJp;e.removeCookie=e.removeCookieJp;});}},"1.0.0",{requires:["cookie","attribute","common-persist-neo-data"]});YUI.add("common-user-session",function(f){var c=f.common,b=c.persist,d,a,e;c.UserSession={getState:function(){var i=b.getCookie("Y"),h,g=b.getCookie("T"),k=g&&g.get("d");try{h=i&&i.get("l");}catch(j){}return{user:h,session:k,newuser:h&&h!=a,expired:k!=e,loggedout:!h};},update:function(){var g=this.getState();a=g.user;e=g.session;},same:function(){var g=this.getState();return !(g.newuser||g.loggedout||g.expired);}};d=NeoConfig.initCookieData||c.UserSession.getState();a=d.user;e=d.session;},"1.0.0",{requires:["common-persist-cookie-data","common-utils"]});YUI.add("common-net-error-base",function(b){b.namespace("common.net");var d=b.common,c=d.net,j=d.Utils,a="HTTPError.",i=c.Error=c.Error||{},g=[502,900,12007,12029,12030,12031,13030,0],e=i.handler=[];function f(k){for(var l=0;l<g.length;l++){if(k==g[l]){return true;}}}function h(l,k){k=k&&k.replace(/<br\/>/g,"\n").replace(/<p\/>/g,"\n");k&&window.alert(k);l&&l();}b.mix(i,{base:a,conn:a+"conn",ydod:a+"999",abort:"abort",timeout:"timeout",unknown:"unknown",login:"login",loginfail:"loginfail",parse:"parse",send:"xhrsend",wssid:"invalidwssid",isHttp:function(k){return/^HTTPError/.test(k);},isConn:function(k){return k=="HTTPError.conn";},isUnexpected:function(k,l){return(!f(k)&&i.isHttp(l)&&(k!=2)&&(k!=999)&&(k!=302));},getErrType:function(m,o){var l=o.status,n=c.Status,k,p;if(l!=200&&l!=500){if(l==n.xhr||l==n.maxsize){k=i.send+"."+o.statusText;}else{if(l==n.abort){k=i.abort;}else{if(l==n.timeout){k=i.timeout;}else{if(m.tries==1){p=(l==0||l==302)&&!d.UserSession.same();}k=p?i.login:(f(l)?i.conn:a+l);o.status=p?401:(l==0?13030:l);}}}}return k;},_fireHandlers:function(){arguments[arguments.length-1]();},_handle:function(){var k=arguments;b.use("common-net-error",function(){i._fireHandlers.apply(i,k);});},onError:function(l,m){var k;j.assert(l);if(m){if((k=b.Array.indexOf(e,l))!=-1){e.splice(k,1);}}else{e.push(l);k=1;}return(k>=0);},show:h,showAlert:h});},"1.0.0",{requires:["common-utils","common-user-session"]});YUI.add("rocket-stats",function(c){var d,b,f,k,g=c.namespace("common.Utils.rocketstats"),l=[],i,a,h;g.stat=function(r,n,q,o){if(!d&&c.one){d=1;c.one(window).on("beforeunload",i);c.one(window).on("unload",i);}if(!NeoConfig||(NeoConfig.trackRocketStat==1)){var m=NeoConfig,p=(m.expBucketId==="0"?(m.isUltThrottled*1?"NoBucket":"NoUlt"):m.expBucketId);h='{"page":"'+r+'","key":"'+n+'"';if(o!==f){h+=',"intl":"'+o+'"';}if(q!==f){h+=',"value":'+q;}h+=',"bucket":"'+p+'"}';l.push(h);j();}};g.intlStat=function(o,m,n){g.stat(o,m,n,true);};function j(){if(l.length>49){clearTimeout(b);e();}else{b=b||setTimeout(e,180000);}}i=g.unloadQ=function(){if(l[0]){e();a=new Date;while(new Date-a<100){}}};function e(){b=0;if(l[0]){try{k=new XMLHttpRequest();k.open("POST","stat");k.send(l.join("\n"));}catch(m){}l=[];}}},"1.0.0");YUI.add("common-net-sessionmgr",function(b){var a=b.common.net;a.SessionMgr=function(){var u=a.Session,g=b.Lang,e=b.JSON,s=a.Error,k=NeoConfig.wssid,p,m=[],c="net:success",h="net:failure",z="net:suspended",d="net:resumed";function r(F,D,B,A,C){var E;if(F){E={code:F,message:D,detail:B,host:C,subcode:A};}return E;}function n(B){var A=B.responseText||"",C;A=A.replace(/<!--?(.*)?-->[\r\n]*$/,"");try{B.body=e.parse(A);}catch(D){b.log("_validateJSON parse error : "+A);C=s.parse;B.fault=r(C,(D.message||"")+" Response parse failed.",{respTxt:A});}}function w(A,B){var C=j.validate[A];if(C){C(B);}else{B.body=B.responseXML||B.responseText;}}function t(D,F){var C,B=0,E,A=F.callback;C=s.getErrType(D,F);if(C){if(C==s.conn){B=2;}E=C==s.abort||C==s.timeout||C==s.login||C.indexOf(s.send)==0;F.fault={code:C};}else{w(A.responseType,F);}if(A.formatter){A.formatter(D,F);}A.retries=E?0:(g.isNumber(A.retries)?A.retries:B);}function y(D){var C=D.allHeadersText||"",B=D.responseText,A;if(C.indexOf("Content-Type: text/html")>-1||((/^<html/i.test(B)||/^<!doctype html/i.test(B))&&(/<\/html>[\s]*$/i.test(B)||/<\/html>[\s]*[\r\n]*<!--?(.*)?-->[\r\n]*$/i.test(B)))){if(/<\/html>[\s]*$/i.test(B)){A="External";}else{if(/<\/html>[\s]*[\r\n]*<!--?(.*)?-->[\r\n]*$/i.test(B)){A="Internal";}else{A="Unknown";}}return A;}}function l(A){A.fault=r(s.unknown);}function q(B){function A(){var C=this;C.success=C.failure=f;C.scope=j;}A.prototype=B;A.prototype.constructor=A;return new A();}function o(A){return A.constructor.prototype;}function f(E,H,D){var B=H,L=H.callback,M,I=H.status,F,G,J,A;function C(){if(A=M&&M.failure){A.call(G,B,F,E);}D();x();}try{t(E,B);if(B.fault&&(E.tries<=L.retries)){b.later(500,null,function(){E.send();});return true;}if(I!=200&&!B.fault){l(B);}M=B.callback=o(L);if(M){F=M.args;G=M.scope;}if(!B.fault){b.fire(c,B);J=M&&M.success;if(J){J.call(G,B,F,E);D();x();}}else{if(I==a.Status.abort){C();}else{b.fire(h,E,B);s._handle(E,B,C);}}}catch(K){b.log("sessionmgr:onResponse exc : "+K.message);}}function i(A){m.push(A);}function x(){if(!p&&m.length){var A=m.shift();if(A&&A.send){A.send();}else{x();}}}function v(D,C){var G=C.data||"",A,H={},B,F=null,E;C=C||{};A=C.on||{};G=C.data||"";B=C.method||"GET";H.service=C.service;H.scope=C.context;H.timeout=C.timeout;H.args=C.args;if(A.success){H.success=function(I,J){A.success(0,I,J);};}if(A.failure){H.failure=function(I,J){A.failure(0,I,J);};}H.responseType=C.responseType||"json";H.suppressCodes=C.suppressCodes||["*"];E=(g.isUndefined(C.sync))?true:!C.sync;return j.request(D,G,H,B,F,E);}var j={request:function(A,C,I,H,D,G){var B,E,F;I=I||{};if(!I.args){I.args={};}F=q(I);if(NeoConfig.disableFullSSL&&NeoConfig.userOptedIntoSSL&&!NeoConfig.isFullSSL&&(A.indexOf("/ws/mail")>-1||A.indexOf("/showMessage")>-1||A.indexOf("/mailsearch/v2/search")>-1)){if(A.indexOf("?")>-1){A+="&ssl=ignore";}else{A+="?ssl=ignore";}}B=new a.Session(A,F,H,C,D);B.setHeader("Content-Type","application/"+(F.responseType||"json"));if(k&&!I.suppressWssid){B.addUrlParam("wssid",k,false);}B.callbackData=I.args;if(G){if(p||m.length){i(B);}else{B.send();}}else{E=B.send;B.send=function(){var J=this;J.send=E;if(p||m.length){i(J);}else{E.apply(J);}};}return B;},requestProxy:v,formatQueryParams:function(B,A){return u.formatQueryParams(B,A);},getWssid:function(){return k;},setWssid:function(C){k=C;for(var B=0,A=m.length;B<A;B++){m[B].addUrlParam("wssid",k,false);}},makeFaultObject:r,validate:{json:n},isHtml:y,suspend:function(A){p=A;b.fire(z,A);},resume:function(){p=0;x();b.fire(d);},queue:i,_qsize:function(){return m.length;},_qclear:function(){m=[];},pingTest:function(){b.common.Utils.rocketstats.stat("net","pingTest");b.log("error:pingTest");}};return j;}();},"1.0.0",{requires:["event-custom-base","common-net-session","common-net-error-base","rocket-stats","json-parse"]});YUI.add("calendar-model-datastore",function(c){var i={uidIdx:{},dateIdx:{}},e={idIdx:{}},g={events:{dateIdx:{}},todos:{dateIdx:{}},mergedResults:{dateIdx:{}},uidIdx:{},startDate:null,endDate:null,totalEvents:null,totalTodos:null,totalResults:null},j={userNameIdx:{}},d={notDone:{uidIdx:{}},done:{uidIdx:{}},fetchDone:false},k=null,p=null,o={},m=null,n={data:{},dbit:false},l={data:{},dbit:false},h={uidIdx:{},fidIdx:{},fetchedFolders:{}},b={uidIdx:{}},a={ownerIdx:{}};_remoteFolderLookup={},_confRoomsStore={},dateFmt="yyyyMMdd";var f=function(){if("debug" in Config.urlArgs){Store={};Store.events=i;Store.folders=e;Store.todos=d;Store.options=n;Store.grpoptions=l;}};f.prototype={getLaunchStatData:function(){var v=this,u,t=0,s=0,r=0,q=0;for(u in e.idIdx){if(e.idIdx[u].get("type")==="EVENT"){if(e.idIdx[u].get("isRemote")){if(e.idIdx[u].get("owner")===Config.holidayAccount){q++;}else{s++;}}else{if(e.idIdx[u].get("url")){r++;}else{t++;}}}}return{totalFolders:e.idIdx.length,totalOwnedCalendars:t,totalFriendsCalendars:s,totalSubscribedCalendars:r,totalHolidayCalendars:q};},getLocalFolderId:function(u,q){var w=this,s,t=e,r=_remoteFolderLookup;if(!r[u]){r[u]={};}if(r[u][q]){return r[u][q];}else{var v={};v.owner=q;if(Config.isEntityView&&Config.isTardisEnabled){v.id=u;}else{v.remoteId=u;}r[u][q]=w.getFolders(v)[0].get("id");return r[u][q];}},purgeEventStore:function(){var q=i;q.uidIdx={};q.dateIdx={};},purgeTodoStore:function(){var q=d;q.notDone={uidIdx:{}};q.done={uidIdx:{}};q.fetchDone=false;},purgeNoteStore:function(){var q=h;q.uidIdx={};q.fidIdx={};},clearEventStore:function(r,w){var s,t=i,q,y,z,x,v,u;if(r==null||w==null){q=c.Object.keys(t.dateIdx).sort();if(!r){r=new Date(q[0].substring(4,6)+"/"+q[0].substring(6,8)+"/"+q[0].substring(0,4));}else{s=q[q.length-1];w=new Date(s.substring(4,6)+"/"+s.substring(6,8)+"/"+s.substring(0,4));}}s=r.clone();while(s<=w){z=s.toString(dateFmt);if(t.dateIdx[z]){for(v=0;v<t.dateIdx[z].length;v++){y=t.dateIdx[z][v];x=y.idxUID;for(u=0;u<x.length;u++){if(x[u]===y){x.splice(u,1);if(y.get("uid") in t.uidIdx&&t.uidIdx[y.get("uid")].length==0){delete t.uidIdx[y.get("uid")];}break;}}t.dateIdx[z][v]=null;delete y;}delete t.dateIdx[z];}s.addDays(1);}},storeEvents:function(v,q,w,r){var x=this,t=i,s=q.clone(),y,u,z;if(!r){x.clearEventStore(q,w);}while(s<=w){z=s.toString(dateFmt);if(!(z in t.dateIdx)){t.dateIdx[z]=[];}s.addDays(1);}for(u=0;u<v.length;u++){y=v[u];if(y.get("startTime")==null){continue;}x.addEvent(y,q,w);}},addEvent:function(x,r,v){var t=i,w=x.get("uid"),q=x.get("startTime"),u=x.get("endTime"),s,y;if(!t.uidIdx[w]){t.uidIdx[w]=[];}t.uidIdx[w].push(x);x.idxUID=t.uidIdx[w];if(r&&q<r){q=r;}if(v&&u>v){u=v;}if(x.get("allDay")){u=u.clone().addMinutes(-1).clearTime();}else{u=u.clone().addMinutes(-1).clearTime().addDays(1).addMinutes(-1);}x.idxDate=[];s=q.clone().clearTime();while(s<=u){y=s.toString(dateFmt);if(!t.dateIdx[y]){t.dateIdx[y]=[];}t.dateIdx[y].push(x);x.idxDate.push(t.dateIdx[y]);s.addDays(1);}},removeEvent:function(u,v){var t=i,w,s,r,q;if(!(u in t.uidIdx)){return;}for(s=t.uidIdx[u].length-1;s>=0;s--){w=t.uidIdx[u][s];if((v&&w.get("recurId")==v)||!v){for(r=0;r<w.idxDate.length;r++){for(q=0;q<w.idxDate[r].length;q++){if(w.idxDate[r][q]===w){w.idxDate[r].splice(q,1);break;}}}t.uidIdx[u].splice(s,1);delete w;}}if(!v||t.uidIdx[u].length==0){delete t.uidIdx[u];}},removeEventsByExId:function(w,q){var u=i,v,t,s,r;for(uid in u.uidIdx){v=u.uidIdx[uid][0];if(v.get("ICalExchangeId")==w){if(q&&v.get("startTime").isBefore(q)){continue;}for(s=0;s<v.idxDate.length;s++){for(r=0;r<v.idxDate[s].length;r++){if(v.idxDate[s][r]===v){v.idxDate[s].splice(r,1);break;}}}u.uidIdx[uid].splice(t,1);delete u.uidIdx[uid];delete v;}}},hasEvents:function(r,u){var s=r.clone(),t=i,q;c.log("Searching for events between "+r+" and "+u);while(s<=u){q=s.toString(dateFmt);if(t.dateIdx[q]==null){return false;}s.addDays(1);}return true;},hasNumEvents:function(r,v){var s=r,t=i,u=0,q;c.log("Searching for "+v+" events from "+r);while(u<v){q=s.toString(dateFmt);if(t.dateIdx[q]==null){c.log("Found "+u+" events");return false;}u+=t.dateIdx[q].length;s.addDays(1);}if(u>=v){return true;}return false;},getEventsByUID:function(v,z){var r=i,q=g,y,x=[],w,u,t,s;if(z&&z.folder&&z.folder==="search"){for(t in q.mergedResults.dateIdx){for(s in q.mergedResults.dateIdx[t]){w=q.mergedResults.dateIdx[t][s];if(w.get("uid")===v){if(w instanceof c.calendar.model.Todo){return[w];}u=true;for(y in z){if(y!=="folder"){if(w.get(y)!==z[y]){u=false;break;}}}if(u){x.push(w);}}}}return x;}else{if(r.uidIdx[v]){if(z){for(t=0;t<r.uidIdx[v].length;t++){w=r.uidIdx[v][t];u=true;for(y in z){if(y!=="folder"){if(y=="startTime"){if(!z[y].isSameDay(w.get("startTime"))){u=false;break;}}else{if(w.get(y)!=z[y]){u=false;break;}}}else{continue;}}if(u){x.push(w);}}return x;}else{return r.uidIdx[v];}}}return null;},getEventsByAttributes:function(A){var w=this,r=i,q=g,z,y=[],x,u,t,s,v;for(v in r.uidIdx){for(t=0;t<r.uidIdx[v].length;t++){x=r.uidIdx[v][t];u=true;for(z in A){if(z!=="folder"){if(z=="startTime"){if(!A[z].isSameDay(x.get("startTime"))){u=false;break;}}else{if(x.get(z)!=A[z]){u=false;break;}}}else{continue;}}if(u){y.push(x);}}}return y;},updateObjectsFromSearchResults:function(r,y,B,u){var x=this,v,t,s,q=g,D=false,z,C=false,w=0,A=0;if(r==="DELETE"){for(v in q.events.dateIdx){for(t in q.events.dateIdx[v]){if(!B){if(q.events.dateIdx[v][t].get("uid")===y){delete q.events.dateIdx[v][t];w++;}}else{if(q.events.dateIdx[v][t].get("uid")===y&&q.events.dateIdx[v][t].get("recurId")===B){delete q.events.dateIdx[v][t];D=true;w++;break;}}}if(D){break;}}D=false;for(v in q.mergedResults.dateIdx){for(t in q.mergedResults.dateIdx[v]){if(!B){if(q.mergedResults.dateIdx[v][t].get("uid")===y){delete q.mergedResults.dateIdx[v][t];}}else{if(q.mergedResults.dateIdx[v][t].get("uid")===y&&q.mergedResults.dateIdx[v][t].get("recurId")===B){delete q.mergedResults.dateIdx[v][t];D=true;break;}}}if(D){break;}}D=false;for(v in q.todos.dateIdx){for(t in q.todos.dateIdx[v]){if(q.todos.dateIdx[v][t].get("uid")===y){delete q.todos.dateIdx[v][t];A++;D=true;break;}if(D){break;}}}q.totalEvents=q.totalEvents-w;q.totalTodos=q.totalTodos-A;q.totalResults=q.totalResults-w-A;}else{if(r==="UPDATE"){if(u instanceof c.calendar.model.Todo){z=q.todos;x.updateTodo(u);}else{if(u instanceof c.calendar.model.Event){z=q.events;C=true;}}D=false;for(v in q.mergedResults.dateIdx){for(t in q.mergedResults.dateIdx[v]){if(!B){if(q.mergedResults.dateIdx[v][t].get("uid")===u.get("uid")){q.mergedResults.dateIdx[v][t]=u;if(!C){D=true;break;}}}else{if((q.mergedResults.dateIdx[v][t].get("uid")===u.get("uid"))&&(q.mergedResults.dateIdx[v][t].get("recurId")===u.get("recurId"))){q.mergedResults.dateIdx[v][t]=u;D=true;break;}}}if(D){break;}}D=false;for(v in z.dateIdx){for(t in z.dateIdx[v]){if(!B){if(z.dateIdx[v][t].get("uid")===u.get("uid")){z.dateIdx[v][t]=u;if(!C){D=true;break;}}}else{if((z.dateIdx[v][t].get("uid")===u.get("uid"))&&(z.dateIdx[v][t].get("recurId")===u.get("recurId"))){z.dateIdx[v][t]=u;D=true;break;}}if(D){break;}}}}}},getObjectsFromSearchResults:function(w,z){var q=g,x=q.uidIdx[w],y,r=[],s,v,u,t;if(x){if(z){for(u=0;u<x.length;u++){s=x[u];if(s instanceof c.calendar.model.Todo){return[s];}v=true;for(y in z){if(y!=="folder"){if(s.get(y)!==z[y]){v=false;break;}}}if(v){r.push(s);}}}else{r=x;}}return r;},getEventsByDateRange:function(r,w){var v=[],u=i,s,q,t;if(!w){w=r;}s=r.clone();while(s<=w){q=s.toString(dateFmt);if(q in u.dateIdx){v=v.concat(c.Array.filter(u.dateIdx[q],function(x){return(Config.isEntityView&&x.get("folder").get("isEntity"))||x.get("folder").get("folderCheck");}));}else{return null;}s.addDays(1);}return c.Array.unique(v);},getDateRangeOfEventsInCache:function(){var s=i,r,t="19000101",q="21000101";for(r in s.dateIdx){if(r*1<q*1){q=r;}if(r*1>t*1){t=r;}}return{startDate:(q==="19000101")?null:q,endDate:(t==="21000101")?null:t};},storeTodos:function(u,r){var t=d,s,q;if(r==="done"){t.fetchDone=true;for(q in t.done.uidIdx){delete t.done.uidIdx[q];}}else{if(r==="allNotDone"){for(q in t.notDone.uidIdx){delete t.notDone.uidIdx[q];}}}for(q=0;q<u.length;q++){s=u[q];if(s.get("status")==="COMPLETED"&&r==="done"){t.done.uidIdx[s.get("uid")]=s;}else{if(s.get("status")!=="COMPLETED"){t.notDone.uidIdx[s.get("uid")]=s;}}}},checkDoneTodoStatus:function(){var q=d;return q.fetchDone;},addTodo:function(q,r){var t=this,s=d;if(r=="allNotDone"){s.notDone.uidIdx[q.get("uid")]=q;}else{if(r=="done"&&s.fetchDone){s.done.uidIdx[q.get("uid")]=q;}}},deleteTodo:function(r){var t=this,q=d,s;if(q.notDone.uidIdx[r.uid]){delete q.notDone.uidIdx[r.uid];s="allNotDone";}else{if(q.done.uidIdx[r.uid]){delete q.done.uidIdx[r.uid];s="done";}}return s;},updateTodo:function(q){var u=this,s=d,r=q.get("uid"),t={notDone:null,done:null};if(s.notDone.uidIdx[r]){if(q.get("status")==="COMPLETED"){t.notDone="delete";delete s.notDone.uidIdx[r];if(s.fetchDone){s.done.uidIdx[r]=q;t.done="add-hidden";}}else{if(s.notDone.uidIdx[r].get("folder").get("id")!==q.get("folder").get("id")){t.changeFolder=true;}s.notDone.uidIdx[r]=q;t.notDone="update";}}else{if(s.fetchDone){if(s.done.uidIdx[r]){if(q.get("status")!=="COMPLETED"){t.done="delete";delete s.done.uidIdx[r];s.notDone.uidIdx[r]=q;t.notDone="add-hidden";}else{s.done.uidIdx[r]=q;t.done="update";}}}}return t;},getTodo:function(q){var s=this,r=d;if(r.notDone.uidIdx[q]){return r.notDone.uidIdx[q];}else{if(r.done.uidIdx[q]){return r.done.uidIdx[q];}}return null;},getTodos:function(s){var x=this,v={fidIdx:[]},w,r,u,t=d,q=x.getFolders({type:"TODO"});for(r in q){v.fidIdx[q[r].get("id")]=[];}v.fidIdx["131"]=[];if(s==="allNotDone"){for(r in t.notDone.uidIdx){u=t.notDone.uidIdx[r];if(!(v.fidIdx[u.get("folder").get("id")])){v.fidIdx[u.get("folder").get("id")]=[];}v.fidIdx[u.get("folder").get("id")].push(u);}}else{if(s==="done"){v=[];for(r in t.done.uidIdx){v.push(t.done.uidIdx[r]);}}}return v;},storeFolders:function(q){e.idIdx=q;},removeFolder:function(u){var q=u.id,t=u.type,s=i,r,w=this,v;if(t=="folder"){for(v in e.idIdx){if(v==q){delete e.idIdx[q];break;}}}for(r in s.uidIdx){if(s.uidIdx[r][0].get("folder").get("id")==q){w.removeEvent(r);}}},removeExchangeSeries:function(q){var t=this,s,r;s=t.getEventsByAttributes({ICalExchangeId:q});for(r in s){t.removeEvent(s[r].get("uid"));}},addFolder:function(q){e.idIdx[q.get("id")]=q;},getFolder:function(q){if(e.idIdx[q]){return e.idIdx[q];}return null;},getFolders:function(s){var u=[],t,q,r;for(t in e.idIdx){r=true;for(q in s){if(q=="type"&&s.type=="TODO"){if(t!="131"&&e.idIdx[t].get("remoteId")!="131"&&e.idIdx[t].get("type")!="TODO"){r=false;break;}}else{if(e.idIdx[t].get(q)!=s[q]){r=false;break;}}}if(r){u.push(e.idIdx[t]);}}return u;},storeSearchResults:function(z){var A,y,w=g.events,u=g.todos,F=g.mergedResults,q=g,C,E,s,t,x,B,r,D,v;if(z==="MERGE"){for(A in F.dateIdx){delete F.dateIdx[A];}if(u.dateIdx[q.startDate.toString(dateFmt)]){F.dateIdx[q.startDate.toString(dateFmt)]=[];for(A in u.dateIdx[q.startDate.toString(dateFmt)]){F.dateIdx[q.startDate.toString(dateFmt)].push(u.dateIdx[q.startDate.toString(dateFmt)][A]);}}for(A in w.dateIdx){if(!F.dateIdx[A]){F.dateIdx[A]=[];}for(y in w.dateIdx[A]){F.dateIdx[A].push(w.dateIdx[A][y]);}}for(A in u.dateIdx){if(A!==q.startDate.toString(dateFmt)){if(!F.dateIdx[A]){F.dateIdx[A]=[];}for(y in u.dateIdx[A]){F.dateIdx[A].push(u.dateIdx[A][y]);}}}q.totalResults=q.totalEvents+q.totalTodos;return;}else{if(z.events){t=z.dtstart;B=z.dtend;for(A in w.dateIdx){delete w.dateIdx[A];}}else{if(z.todos){for(A in u.dateIdx){delete u.dateIdx[A];}}}}if(z.todos){r=[];for(A in z.todos){E=z.todos[A];if(!q.uidIdx[E.get("uid")]){q.uidIdx[E.get("uid")]=[];}q.uidIdx[E.get("uid")].push(E);if(E.get("completedOn")){t=E.get("completedOn");}else{if(E.get("dueOn")!==""){t=E.get("dueOn");}else{t=z.dtstart;}}if(t>=z.dtstart&&t<=z.dtend){s=t.toString(dateFmt);if(!u.dateIdx[s]){u.dateIdx[s]=[];}u.dateIdx[s].push(E);}else{r.push(A);}}for(A=r.length;A>0;A--){z.todos.splice(r[A-1],1);}q.totalTodos=z.todos.length;return;}for(A in z.events){C=z.events[A];s=C.get("startTime");x=C.get("endTime");if(!q.uidIdx[C.get("uid")]){q.uidIdx[C.get("uid")]=[];}q.uidIdx[C.get("uid")].push(C);if(t&&s<t){s=t;}if(B&&x>B){x=B;}if(C.get("allDay")){x=x.clone().addMinutes(-1).clearTime();}else{x=x.clone().clearTime().addDays(1).addMinutes(-1);}v=s.clone().clearTime();D=v.toString(dateFmt);if(!w.dateIdx[D]){w.dateIdx[D]=[];}w.dateIdx[D].push(C);}q.startDate=t.clone();q.endDate=B.clone();q.totalEvents=z.events.length;},storeSharedCalendars:function(s,r){var t=this,q=j;if(!q.userNameIdx[r]){q.userNameIdx[r]=[];}q.userNameIdx[r]=s;},getSharedCalendars:function(r){var s=this,q=j;if(!q.userNameIdx[r]){return null;}else{return q.userNameIdx[r];}},getSearchResults:function(y,r,w){var x=[],u=g.events,s=g.todos,B=g.mergedResults,q=g,t,z,v,A;if(!w){w=r;}if(!r){if(y==="merged"||!y){A=q.totalResults;}else{if(y==="events"){A=q.totalEvents;}else{if(y==="todos"){A=q.totalTodos;}else{if(y==="all"){A={};A.events=q.totalEvents;A.todos=q.totalTodos;A.results=q.totalResults;}}}}return{startDate:q.startDate.clone(),endDate:q.endDate.clone(),totalResults:A};}t=r.clone();if(y==="events"){while(t<=w){z=t.toString(dateFmt);if(z in u.dateIdx){x=x.concat(c.Array.filter(u.dateIdx[z],function(C){return C.get("folder").get("folderCheck");}));}else{return x;}t.addDays(1);}}else{if(y==="todos"){while(t<=w){z=t.toString(dateFmt);if(z in s.dateIdx){x=x.concat(c.Array.filter(s.dateIdx[z],function(C){return C.get("folder").get("folderCheck");}));}else{return x;}t.addDays(1);}}else{if(y==="merged"){while(t<=w){z=t.toString(dateFmt);if(z in B.dateIdx){x=x.concat(B.dateIdx[z]);}else{return x;}t.addDays(1);}}}}return c.Array.unique(x);},storeOptions:function(q){var r=n;if(q){r.data=q;r.dbit=true;}else{r.dbit=false;}},getOptions:function(){var q=n;return q.data;},hasOptions:function(){var q=n;return q.dbit;},storeGrpOptions:function(q){var r=l;if(q){r.data=q;r.dbit=true;}else{r.dbit=false;}},getGrpOptions:function(){var q=l;return q.data;},hasGrpOptions:function(){var q=l;return q.dbit;},getSearchTags:function(q){if(!m){if(localStorage&&localStorage.searchTagsStore){m=c.JSON.parse(localStorage.searchTagsStore);}}return m;},setSearchTags:function(q){m=q;if(localStorage){localStorage.searchTagsStore=c.JSON.stringify(m);}},getInterestingCalendar:function(q){return o[q];},setInterestingCalendar:function(q,r){o[q]=r;},getWeather:function(){return k;},getMailUserData:function(){return p;},changeWeatherUnits:function(){var q=this;k.tempUnits=(k.tempUnits=="F")?"C":"F";Prefs.weatherUnits=k.tempUnits;q.updatePref({wtunits:Prefs.weatherUnits});},updatePref:function(r){var q={method:"POST",headers:{"Content-Type":"application/json"},data:c.JSON.stringify(r),success:function(){},failure:function(){}},s=new c.lib.Net().exec(Config.docRoot+"?wssid="+Config.crumb+"&prefUp",q);},setWeather:function(v){var t,w=v.days,s,u,r,q;if(v.tempUnits=="F"){for(t in w){s=w[t];s.highF=u=parseInt(s.high);s.lowF=r=parseInt(s.low);s.highC=Math.round((u-32)*0.55);s.lowC=Math.round((r-32)*0.55);if(s.currentTemp){s.currentTempF=q=s.currentTemp&&parseInt(s.currentTemp);s.currentTempC=Math.round((q-32)*0.55);}}}else{for(t in w){s=w[t];s.highC=u=parseInt(s.high);s.lowC=r=parseInt(s.low);s.highF=Math.round(u*1.8+32);s.lowF=Math.round(r*1.8+32);if(s.currentTemp){s.currentTempC=q=s.currentTemp&&parseInt(s.currentTemp);s.currentTempF=Math.round(q*1.8+32);}}}if(Prefs.weatherUnits){v.tempUnits=Prefs.weatherUnits;}k=v;},setMailUserData:function(q){p=q;},storeNotes:function(r,s){var t=h,q;if(s){for(q in s){t.fidIdx[s[q]]=[];t.fetchedFolders[s[q]]=true;}}for(q in r){if(!Config.isTardisEnabled){r[q].set("summary",c.lib.Utils.escapeHtml(r[q].get("summary")));r[q].set("description",c.lib.Utils.escapeHtml(r[q].get("description")));}t.uidIdx[r[q].get("uid")]=r[q];if(!t.fidIdx[r[q].get("folder").get("id")]){t.fidIdx[r[q].get("folder").get("id")]=[];}t.fidIdx[r[q].get("folder").get("id")].push(r[q]);}},getNotes:function(s){var r=h,q;if(s.uid){return r.uidIdx[s.uid];}else{if(s.fid){if(!r.fetchedFolders[s.fid]){return null;}else{return r.fidIdx[s.fid];}}else{if(s.summary){for(q in r.uidIdx){if(r.uidIdx[q].get("summary")===s.summary){return r.uidIdx[q];}}return null;}}}},addNote:function(q){var r=h;if(!Config.isTardisEnabled){q.set("summary",c.lib.Utils.escapeHtml(q.get("summary")));q.set("description",c.lib.Utils.escapeHtml(q.get("description")));}r.uidIdx[q.get("uid")]=q;r.fidIdx[q.get("folder").get("id")].push(q);},updateNote:function(u,v){var w=h,s,r,q,t=w.uidIdx[u.get("uid")];if(!t){return;}if(!Config.isTardisEnabled){u.set("summary",c.lib.Utils.escapeHtml(u.get("summary")));u.set("description",c.lib.Utils.escapeHtml(u.get("description")));}for(s in w.fidIdx){if(s===t.get("folder").get("id")){for(r in w.fidIdx[s]){if(w.fidIdx[s][r].get("uid")===t.get("uid")){if(v){delete w.fidIdx[s][r];}else{w.fidIdx[s][r]=u;}}}}}if(v){if(!w.fidIdx[u.get("folder").get("id")]){w.fidIdx[u.get("folder").get("id")]=[];}w.fidIdx[u.get("folder").get("id")].push(u);}w.uidIdx[u.get("uid")]=u;},deleteNote:function(s){var t=h,r,q;delete t.uidIdx[s];for(r in t.fidIdx){for(q in t.fidIdx[r]){if(t.fidIdx[r][q].get("uid")===s){delete t.fidIdx[r][q];}}}},storeNoteSearchResults:function(s){var q=b,r;q.uidIdx={};for(r in s){if(!Config.isTardisEnabled){s[r].set("summary",c.lib.Utils.escapeHtml(s[r].get("summary")));s[r].set("description",c.lib.Utils.escapeHtml(s[r].get("description")));}q.uidIdx[s[r].get("uid")]=s[r];h.uidIdx[s[r].get("uid")]=s[r];}},getNoteSearchResults:function(){var r=b,s,q=[];for(s in r.uidIdx){q.push(r.uidIdx[s]);}return q;},updateNoteSearchResults:function(r,s){var q=b;if(s&&(s.mode==="DELETE")){delete q.uidIdx[s.uid];}else{if(!Config.isTardisEnabled){r.set("summary",c.lib.Utils.escapeHtml(r.get("summary")));r.set("description",c.lib.Utils.escapeHtml(r.get("description")));}q.uidIdx[r.get("uid")]=r;}},storeConfRooms:function(){if(Config.partner==="ycorp"){if(c.Lang.isUndefined(_confRoomsStore.roomData)){var q={method:"GET",headers:{"Content-Type":"application/json"},success:function(r){c.common.net.SessionMgr.validate.json(r);_confRoomsStore=r.body;},failure:function(r){}};new c.lib.Net().exec(Config.docRoot+"acRooms/allRoomsDB.txt?",q);}}},getConfRooms:function(){return _confRoomsStore;},storeRichEvent:function(s,r,q){var u=this,t=a;if(!t.ownerIdx[q]){t.ownerIdx[q]={};}t.ownerIdx[q][r]=s;},getRichEvent:function(r,q){var t=this,s=a;if(s.ownerIdx[q]&&s.ownerIdx[q][r]){return s.ownerIdx[q][r];}return null;}};c.namespace("calendar.model");c.calendar.model.dataStore=new f();},"1.0.0",{requires:["collection","calendar-model-event","calendar-model-todo","common-net-sessionmgr"]});YUI.add("lib-utils-date",function(a){Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:[strings.str_mail_weekday_sunday,strings.str_mail_weekday_monday,strings.str_mail_weekday_tuesday,strings.str_mail_weekday_wednesday,strings.str_mail_weekday_thursday,strings.str_mail_weekday_friday,strings.str_mail_weekday_saturday],abbreviatedDayNames:[strings.str_cal_short_sun,strings.str_cal_short_mon,strings.str_cal_short_tue,strings.str_cal_short_wed,strings.str_cal_short_thu,strings.str_cal_short_fri,strings.str_cal_short_sat],abbreviatedDayNamesTitleCase:[strings.str_cal_abbr_sun,strings.str_cal_abbr_mon,strings.str_cal_abbr_tue,strings.str_cal_abbr_wed,strings.str_cal_abbr_thu,strings.str_cal_abbr_fri,strings.str_cal_abbr_sat],shortestDayNames:[strings.str_weekday_su,strings.str_weekday_mo,strings.str_weekday_tu,strings.str_weekday_we,strings.str_weekday_th,strings.str_weekday_fr,strings.str_weekday_sa],firstCharDayNames:[strings.str_weekday_sun,strings.str_weekday_mon,strings.str_weekday_tue,strings.str_weekday_wed,strings.str_weekday_thu,strings.str_weekday_fri,strings.str_weekday_sat],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:[strings.str_mail_month_january,strings.str_mail_month_february,strings.str_mail_month_march,strings.str_mail_month_april,strings.str_mail_month_may,strings.str_mail_month_june,strings.str_mail_month_july,strings.str_mail_month_august,strings.str_mail_month_september,strings.str_mail_month_october,strings.str_mail_month_november,strings.str_mail_month_december],abbreviatedMonthNames:[strings.str_cal_short_jan,strings.str_cal_short_feb,strings.str_cal_short_mar,strings.str_cal_short_apr,strings.str_cal_short_may,strings.str_cal_short_jun,strings.str_cal_short_jul,strings.str_cal_short_aug,strings.str_cal_short_sep,strings.str_cal_short_oct,strings.str_cal_short_nov,strings.str_cal_short_dec],abbreviatedMonthNamesTitleCase:[strings.str_cal_short_titlecase_jan,strings.str_cal_short_titlecase_feb,strings.str_cal_short_titlecase_mar,strings.str_cal_short_titlecase_apr,strings.str_cal_short_titlecase_may,strings.str_cal_short_titlecase_jun,strings.str_cal_short_titlecase_jul,strings.str_cal_short_titlecase_aug,strings.str_cal_short_titlecase_sep,strings.str_cal_short_titlecase_oct,strings.str_cal_short_titlecase_nov,strings.str_cal_short_titlecase_dec],amDesignator:strings.str_cal_dateformat_AM,pmDesignator:strings.str_cal_dateformat_PM,firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i,separator:/[^a-zA-Z0-9]/},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]};(function(){var e=Date,j=e.prototype,f=e.CultureInfo,b=function(m,k){if(!k){k=2;}return("000"+m).slice(k*-1);};j.clearTime=function(){this.setHours(0);this.setMinutes(0);this.setSeconds(0);this.setMilliseconds(0);return this;};j.setTimeToNow=function(){var k=new Date();this.setHours(k.getHours());this.setMinutes(k.getMinutes());this.setSeconds(k.getSeconds());this.setMilliseconds(k.getMilliseconds());return this;};e.today=function(){return new Date().clearTime();};e.compare=function(l,k){if(isNaN(l)||isNaN(k)){throw new Error(l+" - "+k);}else{if(l instanceof Date&&k instanceof Date){return(l<k)?-1:(l>k)?1:0;}else{throw new TypeError(l+" - "+k);}}};e.equals=function(l,k){return(l.compareTo(k)===0);};e.getDayNumberFromName=function(l){var t=f.dayNames,k=f.abbreviatedDayNames,r=f.shortestDayNames,q=l.toLowerCase();var p;for(p=0;p<t.length;p++){if(t[p].toLowerCase()===q||k[p].toLowerCase()===q||r[p].toLowerCase()===q){return p;}}return -1;};e.getMonthNumberFromName=function(l){var q=f.monthNames,k=f.abbreviatedMonthNames,p=l.toLowerCase();var o;for(o=0;o<q.length;o++){if(q[o].toLowerCase()===p||k[o].toLowerCase()===p){return o;}}return -1;};e.isLeapYear=function(k){return((k%4===0&&k%100!==0)||k%400===0);};e.getDaysInMonth=function(k,l){return[31,(e.isLeapYear(k)?29:28),31,30,31,30,31,31,30,31,30,31][l];};e.getTimezoneAbbreviation=function(n){var m=f.timezones,l;var k;for(k=0;k<m.length;k++){if(m[k].offset===n){return m[k].name;}}return null;};e.getTimezoneOffset=function(k){var n=f.timezones,m,l;for(l=0;l<n.length;l++){if(n[l].name===k.toUpperCase()){return n[l].offset;}}return null;};j.clone=function(){return new Date(this.getTime());};j.compareTo=function(k){return Date.compare(this,k);};j.equals=function(k){return Date.equals(this,k||new Date());};j.between=function(l,k){return this.getTime()>=l.getTime()&&this.getTime()<=k.getTime();};j.isAfter=function(k){return this.compareTo(k||new Date())===1;};j.isBefore=function(k){return(this.compareTo(k||new Date())===-1);};j.isToday=j.isSameDay=function(k){return this.clone().clearTime().equals((k||new Date()).clone().clearTime());};j.addMilliseconds=function(k){this.setTime(this.getTime()+k*1);return this;};j.addSeconds=function(k){return this.addMilliseconds(k*1000);};j.addMinutes=function(k){return this.addMilliseconds(k*60000);};j.addHours=function(k){return this.addMilliseconds(k*3600000);};j.addDays=function(l){var k=this.clone();this.setDate(this.getDate()+l*1);if(this.getMonth()==k.getMonth()&&(this.getDate()-k.getDate())!=l){this.setTime(k.addHours(24*l).getTime());}return this;};j.addWeeks=function(k){return this.addDays(k*7);};j.addMonths=function(k){var l=this.getDate();this.setDate(1);this.setMonth(this.getMonth()+k*1);this.setDate(Math.min(l,e.getDaysInMonth(this.getFullYear(),this.getMonth())));return this;};j.addYears=function(k){return this.addMonths(k*12);};j.add=function(l){if(typeof l==="number"){this._orient=l;return this;}var k=l;if(k.milliseconds){this.addMilliseconds(k.milliseconds);}if(k.seconds){this.addSeconds(k.seconds);}if(k.minutes){this.addMinutes(k.minutes);}if(k.hours){this.addHours(k.hours);}if(k.weeks){this.addWeeks(k.weeks);}if(k.months){this.addMonths(k.months);}if(k.years){this.addYears(k.years);}if(k.days){this.addDays(k.days);}return this;};var d,i,c;j.getWeek=function(){var t,r,q,p,o,m,l,k,v,u;d=(!d)?this.getFullYear():d;i=(!i)?this.getMonth()+1:i;c=(!c)?this.getDate():c;if(i<=2){t=d-1;r=(t/4|0)-(t/100|0)+(t/400|0);q=((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0);v=r-q;o=0;m=c-1+(31*(i-1));}else{t=d;r=(t/4|0)-(t/100|0)+(t/400|0);q=((t-1)/4|0)-((t-1)/100|0)+((t-1)/400|0);v=r-q;o=v+1;m=c+((153*(i-3)+2)/5)+58+v;}l=(t+r)%7;p=(m+l-o)%7;k=(m+3-p)|0;if(k<0){u=53-((l-v)/5|0);}else{if(k>364+v){u=1;}else{u=(k/7|0)+1;}}d=i=c=null;return u;};j.getISOWeek=function(){d=this.getUTCFullYear();i=this.getUTCMonth()+1;c=this.getUTCDate();return b(this.getWeek());};j.setWeek=function(k){return this.moveToDayOfWeek(1).addWeeks(k-this.getWeek());};var h=function(o,m,k,l){if(typeof o==="undefined"||isNaN(o)){return false;}else{if(typeof o!=="number"){throw new TypeError(o+" is not a Number.");}else{if(o<m||o>k){throw new RangeError(o+" is not a valid value for "+l+".");}}}return true;};e.validateMillisecond=function(k){return h(k,0,999,"millisecond");};e.validateSecond=function(k){return h(k,0,59,"second");};e.validateMinute=function(k){return h(k,0,59,"minute");};e.validateHour=function(k){return h(k,0,23,"hour");};e.validateDay=function(l,k,m){return h(l,1,e.getDaysInMonth(k,m),"day");};e.validateMonth=function(k){return h(k,0,11,"month");};e.validateYear=function(k){return h(k,0,9999,"year");};j.set=function(k){if(e.validateMillisecond(k.millisecond)){this.addMilliseconds(k.millisecond-this.getMilliseconds());}if(e.validateSecond(k.second)){this.addSeconds(k.second-this.getSeconds());}if(e.validateMinute(k.minute)){this.addMinutes(k.minute-this.getMinutes());}if(e.validateHour(k.hour)){this.addHours(k.hour-this.getHours());}if(e.validateMonth(k.month)){this.addMonths(k.month-this.getMonth());}if(e.validateYear(k.year)){this.addYears(k.year-this.getFullYear());}if(e.validateDay(k.day,this.getFullYear(),this.getMonth())){this.addDays(k.day-this.getDate());}if(k.timezone){this.setTimezone(k.timezone);}if(k.timezoneOffset){this.setTimezoneOffset(k.timezoneOffset);}if(k.week&&h(k.week,0,53,"week")){this.setWeek(k.week);}return this;};j.moveToFirstDayOfMonth=function(){return this.set({day:1});};j.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())});};j.moveToNthOccurrence=function(l,m){var k=0;if(m>0){k=m-1;}else{if(m===-1){this.moveToLastDayOfMonth();if(this.getDay()!==l){this.moveToDayOfWeek(l,-1);}return this;}}return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(l,+1).addWeeks(k);};j.moveToDayOfWeek=function(k,l){var m=(k-this.getDay()+7*(l||+1))%7;return this.addDays((m===0)?m+=7*(l||+1):m);};j.moveToMonth=function(m,k){var l=(m-this.getMonth()+12*(k||+1))%12;return this.addMonths((l===0)?l+=12*(k||+1):l);};j.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/86400000)+1;};j.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset());};j.setTimezoneOffset=function(m){var k=this.getTimezoneOffset(),l=Number(m)*-6/10;return this.addMinutes(l-k);};j.setTimezone=function(k){return this.setTimezoneOffset(e.getTimezoneOffset(k));};j.hasDaylightSavingTime=function(){return(Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset());};j.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==this.getTimezoneOffset();};j.getUTCOffset=function(){var l=this.getTimezoneOffset()*-10/6,k;if(l<0){k=(l-10000).toString();return k.charAt(0)+k.substr(2);}else{k=(l+10000).toString();return"+"+k.substr(1);}};j.getElapsed=function(k){return(k||new Date())-this;};if(!j.toISOString){j.toISOString=function(){function k(l){return l<10?"0"+l:l;}return'"'+this.getUTCFullYear()+"-"+k(this.getUTCMonth()+1)+"-"+k(this.getUTCDate())+"T"+k(this.getUTCHours())+":"+k(this.getUTCMinutes())+":"+k(this.getUTCSeconds())+'Z"';};}if(!j._toString){j._toString=j.toString;}j.toString=function(n){var k=this;var l=function(o){switch(o*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th";}};var m=function(o){if(o.charAt(0)==="\\"){return o.replace("\\","");}k.h=k.getHours;switch(o){case"hh":return b(k.h()<13?(k.h()===0?12:k.h()):(k.h()-12));case"h":return k.h()<13?(k.h()===0?12:k.h()):(k.h()-12);case"HH":return b(k.h());case"H":return k.h();case"mm":return b(k.getMinutes());case"m":return k.getMinutes();case"ss":return b(k.getSeconds());case"s":return k.getSeconds();case"yyyy":return b(k.getFullYear(),4);case"yy":return b(k.getFullYear());case"dddd":return f.dayNames[k.getDay()];case"ddd":return f.abbreviatedDayNames[k.getDay()];case"Ddd":return f.abbreviatedDayNamesTitleCase[k.getDay()];case"dd":return b(k.getDate());case"d":return k.getDate();case"MMMM":return f.monthNames[k.getMonth()];case"MMM":return f.abbreviatedMonthNames[k.getMonth()];case"Mmm":return f.abbreviatedMonthNamesTitleCase[k.getMonth()];case"MM":return b((k.getMonth()+1));case"M":return k.getMonth()+1;case"t":return k.h()<12?f.amDesignator.substring(0,1):f.pmDesignator.substring(0,1);case"tt":return k.h()<12?f.amDesignator:f.pmDesignator;case"S":return l(k.getDate());default:return o;}};if(/\{/.test(n)){if(n){return n.replace(/\{(d{1,4}|M{1,4}|Mmm|Ddd|yy(yy)?|hh?|HH?|mm?|ss?|tt?|S)\}/g,function(o){return m(o.replace(/\{|\}/g,""));});}return this._toString();}else{return n?n.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,m):this._toString();}};e.getNextDay=function(k){return k.add({days:1});};j.getFirstDayOfMonthView=function(k){var l=this.clone();if(l.moveToFirstDayOfMonth().getDay()!=k){return l.moveToDayOfWeek(k,-1);}else{return l;}};j.getLastDayOfMonthView=function(k){var l=this.clone();if(l.moveToLastDayOfMonth().getDay()!==(k+6)%7){return l.moveToDayOfWeek(k-1);}else{return l;}};j.isSameMonth=function(m){var l=this.getMonth(),o=this.getFullYear(),k=m.getMonth(),n=m.getFullYear();if(l===k&&o===n){return 1;}return 0;};j.getFirstDayOfWeekView=function(k){var m=this.clone(),l=m.getDay();if(l==k){return m;}else{if(l<k){return m.addDays((k-l)-7);}else{return m.addDays(k-l);}}};j.getLastDayOfWeekView=function(k){return this.getFirstDayOfWeekView(k).add({days:6});};e.getMonthNameFromNumber=function(k){return f.abbreviatedMonthNames[k];};e.getFirstLetterDayNameFromNumber=function(k){return f.firstCharDayNames[k];};e.getShortDayNameFromNumber=function(k){return f.shortestDayNames[k];};j.getFullYearFrom2Digit=function(m){var l,k;l=new Date().getFullYear();k=l%100;if(k>=m){l=2000+m;}else{l=1900+m;}return l;};e.validateDate=function(k,r){var l,q=null,o=null,p=null,m,s;if(!r){r=strings.str_cal_fmt_addEvent_date;}m=r.match(/\{[^}]+\}/g);s=k.match(/\d+/g);try{for(l=0;l<3;l++){if(/M/.test(m[l])&&o===null){o=s[l]*1;}else{if(/d/.test(m[l])&&q===null){q=s[l]*1;}else{if(/y/.test(m[l])&&p===null){p=s[l]*1;}}}}if(Date.validateMonth(o-1)&&Date.validateYear(p)&&Date.validateDay(q,p,o-1)){return new Date(o+"/"+q+"/"+p);}}catch(n){return false;}return false;};var g=(function(){var m="s",n=function(r){var s=-r.getTimezoneOffset();return(s!==null?s:0);},k=function(){return n(new Date(2010,0,1,0,0,0,0));},l=function(){return n(new Date(2010,5,1,0,0,0,0));},p=function(s){var t=((s.getMonth()>5?l():k())),r=n(s);return(t-r)!==0;},q=function(){var r=k(),s=l(),t=k()-l();if(t<0){return r+",1";}else{if(t>0){return s+",1,"+m;}}return r+",0";},o=function(){var r=q();return new g.TimeZone(g.olson.timezones[r]);};return{determine_timezone:o,date_is_dst:p};}());g.TimeZone=(function(){var p=null,m=null,n=null,k=function(){return p;},q=function(){return m;},o=function(){return n;},l=function(){var t=g.olson.ambiguity_list[p],v=t.length,u=0,w=t[0];for(;u<v;u+=1){w=t[u];if(g.date_is_dst(g.olson.dst_start_dates[w])){p=w;return;}}},r=function(){return typeof(g.olson.ambiguity_list[p])!=="undefined";},s=function(t){n=t[0];p=t[1];m=t[2];if(r()){l();}};s.prototype={constructor:g.TimeZone,name:k,dst:q,offset:o};return s;}());g.olson={};g.olson.timezones=(function(){return{"-720,0":["-12:00","Etc/GMT+12",false],"-660,0":["-11:00","Pacific/Midway",false],"-660,1,s":["-11:00","Pacific/Midway",false],"-600,0":["-10:00","Pacific/Honolulu",false],"-570,0":["-09:30","Pacific/Marquesas",false],"-540,1":["-09:00","America/Anchorage",true],"-480,1":["-08:00","America/Los_Angeles",true],"-480,0":["-08:00","Pacific/Pitcairn",false],"-420,0":["-07:00","America/Phoenix",false],"-420,1":["-07:00","America/Denver",true],"-360,0":["-06:00","America/Guatemala",false],"-360,1":["-06:00","America/Chicago",true],"-300,0":["-05:00","America/Bogota",false],"-300,1":["-05:00","America/New_York",true],"-270,0":["-04:30","America/Caracas",false],"-240,1":["-04:00","America/Halifax",true],"-240,0":["-04:00","America/Guyana",false],"-240,1,s":["-04:00","America/Santiago",true],"-210,1":["-03:30","America/St_Johns",true],"-180,1":["-03:00","America/Godthab",true],"-180,0":["-03:00","America/Argentina/Buenos_Aires",false],"-180,1,s":["-03:00","America/Montevideo",true],"-120,0":["-02:00","Atlantic/South_Georgia",false],"-60,1":["-01:00","Atlantic/Azores",true],"-60,0":["-01:00","Atlantic/Cape_Verde",false],"0,0":["00:00","Africa/Monrovia",false],"0,1":["00:00","Europe/London",true],"60,1":["+01:00","Europe/Berlin",true],"60,0":["+01:00","Africa/Algiers",false],"60,1,s":["+01:00","Africa/Windhoek",true],"120,1":["+02:00","Asia/Beirut",true],"120,0":["+02:00","Africa/Cairo",false],"180,1":["+03:00","Europe/Moscow",true],"180,0":["+03:00","Asia/Baghdad",false],"210,1":["+03:30","Asia/Tehran",true],"240,1":["+04:00","Asia/Baku",true],"240,0":["+04:00","Asia/Yerevan",false],"270,0":["+04:30","Asia/Kabul",false],"300,1":["+05:00","Asia/Yekaterinburg",true],"300,0":["+05:00","Asia/Karachi",false],"330,0":["+05:30","Asia/Kolkata",false],"345,0":["+05:45","Asia/Kathmandu",false],"360,0":["+06:00","Asia/Dhaka",false],"390,0":["+06:30","Asia/Rangoon",false],"420,1":["+07:00","Asia/Krasnoyarsk",true],"420,0":["+07:00","Asia/Bangkok",false],"480,0":["+08:00","Asia/Hong_Kong",false],"480,1":["+08:00","Asia/Irkutsk",true],"540,1":["+09:00","Asia/Yakutsk",true],"540,0":["+09:00","Asia/Tokyo",false],"570,0":["+09:30","Australia/Darwin",false],"570,1,s":["+09:30","Australia/Adelaide",true],"600,0":["+10:00","Australia/Brisbane",false],"600,1":["+10:00","Asia/Vladivostok",true],"600,1,s":["+10:00","Australia/Sydney",true],"630,1,s":["+10:30","Australia/Lord_Howe",true],"660,0":["+11:00","Asia/Magadan",false],"690,0":["+11:30","Pacific/Norfolk",false],"720,0":["+12:00","Pacific/Fiji",false],"720,1,s":["+12:00","Pacific/Auckland",true],"780,0":["+13:00","Pacific/Tongatapu",false]};}());g.olson.dst_start_dates=(function(){return{"America/Denver":new Date(2011,2,13,3,0,0,0),"America/Mazatlan":new Date(2011,3,3,3,0,0,0),"America/Chicago":new Date(2011,2,13,3,0,0,0),"America/Mexico_City":new Date(2011,3,3,3,0,0,0),"Atlantic/Stanley":new Date(2011,8,4,7,0,0,0),"America/Asuncion":new Date(2011,9,2,3,0,0,0),"America/Santiago":new Date(2011,9,9,3,0,0,0),"America/Campo_Grande":new Date(2011,9,16,5,0,0,0),"America/Montevideo":new Date(2011,9,2,3,0,0,0),"America/Sao_Paulo":new Date(2011,9,16,5,0,0,0),"America/Los_Angeles":new Date(2011,2,13,8,0,0,0),"America/Santa_Isabel":new Date(2011,3,5,8,0,0,0),"America/Havana":new Date(2011,2,13,2,0,0,0),"America/New_York":new Date(2011,2,13,7,0,0,0),"Asia/Gaza":new Date(2011,2,26,23,0,0,0),"Asia/Beirut":new Date(2011,2,27,1,0,0,0),"Europe/Minsk":new Date(2011,2,27,2,0,0,0),"Europe/Helsinki":new Date(2011,2,27,4,0,0,0),"Europe/Istanbul":new Date(2011,2,28,5,0,0,0),"Asia/Damascus":new Date(2011,3,1,2,0,0,0),"Asia/Jerusalem":new Date(2011,3,1,6,0,0,0),"Africa/Cairo":new Date(2010,3,30,4,0,0,0),"Asia/Yerevan":new Date(2011,2,27,4,0,0,0),"Asia/Baku":new Date(2011,2,27,8,0,0,0),"Pacific/Auckland":new Date(2011,8,26,7,0,0,0),"Pacific/Fiji":new Date(2010,11,29,23,0,0,0),"America/Halifax":new Date(2011,2,13,6,0,0,0),"America/Goose_Bay":new Date(2011,2,13,2,1,0,0),"America/Miquelon":new Date(2011,2,13,5,0,0,0),"America/Godthab":new Date(2011,2,27,1,0,0,0)};}());g.olson.ambiguity_list={"America/Denver":["America/Denver"],"America/Chicago":["America/Chicago","America/Mexico_City"],"America/Asuncion":["Atlantic/Stanley","America/Santiago"],"America/Montevideo":["America/Montevideo","America/Sao_Paulo"],"Asia/Beirut":["Asia/Beirut","Europe/Minsk","Europe/Helsinki","Asia/Jerusalem","Africa/Cairo"],"Asia/Yerevan":["Asia/Yerevan","Asia/Baku"],"Pacific/Auckland":["Pacific/Auckland","Pacific/Fiji"],"America/Los_Angeles":["America/Los_Angeles"],"America/New_York":["America/New_York"],"America/Halifax":["America/Halifax"],"America/Godthab":["America/Godthab"]};e.determine_timezone=function(){return g.determine_timezone().name();};}());},"1.0.0",{requires:["substitute"]});YUI.add("lib-utils-errorHandler",function(c){var a=[];var b=function(d){var e=this;a=[];a.push(d.on("datamodel:APIError",e.handleError,e));e.dialogDisplayed=false;};b.prototype={handleError:function(f){var g=this,d;if(!g.dialogDisplayed&&f.details[0]){c.use("calendar-dialogs-errorHandler-controller",function(h){var e=new h.calendar.dialogs.errorHandler.controller({callBack:function(){g.dialogDisplayed=false;}});e.execute(f.details[0],f.details[1]);});g.dialogDisplayed=true;}}};c.namespace("lib.utils");c.lib.utils.ErrorHandler=b;},"1.0.0",{requires:["attribute-base","event-base"]});YUI.add("calendar-model-plugin-autorefresh",function(b){var a=function(c){var e=this,d={data:{value:null},datamodel:{value:null},refreshTime:{value:parseInt(Config.cfg.autoRefreshInterval)||300000},synchToken:{value:null},calservice:{value:null},decreaseRefreshFrequency:{value:!Config.cfg.isCalTabVisible},lastRefreshTimeStamp:{value:null},datastore:{value:null}};b.augment(e,b.Attribute);e.addAttrs(d,c||{});};a.prototype={timer:null,startRefreshTimer:function(h){var j=this,g=j.get("lastRefreshTimeStamp"),f=new Date(),i=parseInt(Config.cfg.autoRefreshInterval),d=j.get("callee")||b.calendar.model.dataModel,c=j.get("refreshTime"),e=false;if(h){c=10;e=!g||((f-g)<i);j.set("decreaseRefreshFrequency",false);j.set("refreshTime",i);}else{if(j.get("decreaseRefreshFrequency")&&((c+i)<4*i)){j.set("refreshTime",c+i);}}if(!e){h&&j.stopRefreshTimer();j.timer=b.Lang.later(c,j,j.synch);}},stopRefreshTimer:function(){var c=this;clearTimeout(c.timer);},synch:function(){var d=this,c=d.get("datamodel");d.checkSynchStatus(d.get("synchToken"),function(e){Config.consoleLogger&&Config.consoleLogger("Need to refresh = "+e);if(e){d.refreshData();}else{d.startRefreshTimer();Config.consoleLogger&&Config.consoleLogger("No need to refresh data BUT redrawing the grid anyways...");c.fire("datamodel:eventsAvailable");}});},checkSynchStatus:function(d,c){var e=this;if(Config.isTardisEnabled){return e.checkSynchStatusV3(d,c);}else{return e.checkSynchStatusV2(d,c);}},checkSynchStatusV3:function(e,c){var h=this,d=h.get("datamodel"),g,f;g=d.getFolders();d.getFolders({},true,{success:function(k){var j;f=k;h.set("lastRefreshTimeStamp",new Date());for(j in g){currentETag=g[j].get("ETag");currentFolderId=g[j].get("id");if(f[currentFolderId]&&(currentETag!==f[currentFolderId].get("ETag"))){Config.consoleLogger&&Config.consoleLogger("Something changed in folder id "+currentFolderId+" !!");h.get("datamodel").updateFolderStore(k);c(true);return;}}c(false);},failure:function(){Config.consoleLogger&&Config.consoleLogger("Failed to fetch folders for sync polling...");h.startRefreshTimer();}});},checkSynchStatusV2:function(f,g){var k=this,i=k.get("datamodel"),e=k.get("datastore"),l=k.get("calservice"),h=false,c=i.get("currentDate"),d,j=null,m;m=k.getDateRange(null);d=m.startDate;j=m.endDate;l.synchPoll({synchToken:f,dtstart:d,dtend:j},null,{success:function(r){var q=r.folder,p=k.get("lastRefreshTimeStamp"),n=new Date();if(p&&(p.getDate()!=n.getDate())){k.get("datamodel").set("currentDate",n);}k.set("lastRefreshTimeStamp",n);if(q){if(q.hasChanges&&f){g(true);}else{g(false);}k.set("synchToken",q.syncToken);}},failure:function(q){var p=k.get("lastRefreshTimeStamp"),n=new Date();Config.consoleLogger&&Config.consoleLogger("Poll call failed!");if(p&&(p.getDate()!=n.getDate())){k.get("datamodel").set("currentDate",n);}k.set("lastRefreshTimeStamp",n);k.startRefreshTimer();}});return h;},refreshData:function(d){var e=this,c=e.get("datamodel")||b.calendar.model.dataModel;if(d&&!Config.isTardisEnabled){e.checkSynchStatus(null,function(f){Config.consoleLogger&&Config.consoleLogger("Set sync token for the first time!");});}e.getNewData(null,d);},getNewData:function(f,l){var i=this,g=i.get("datamodel"),e=i.get("datastore"),j=i.get("calservice"),c=f||g.get("currentDate"),d,h=null,m,k=false;m=i.getDateRange(f);d=m.startDate;h=m.endDate;k=m.purgeCache;j.getEvents({dtstart:d,dtend:h,detail:"true"},{success:function(o){var n=g.processEventResponse(o,f),p={};if(!n){n=[];}i.startRefreshTimer();p.data=setInterval(function(){i.updateDataStore(n,o.startDate,o.endDate.clearTime().addDays(1).addMinutes(-1),l,p,k);},10);},failure:function(n){Config.consoleLogger&&Config.consoleLogger("GetDetails call post launch... FAILED!");i.startRefreshTimer();}});},getDateRange:function(g){var l=this,i=l.get("datamodel"),f=l.get("datastore"),m=l.get("calservice"),d=g||i.get("currentDate"),e,j=null,c,n,r,q,p=/((....)(..)(..))/,k=/((....)(..)(..))/,h=false,o=false;if(i.get("currentView")==="list"){e=d.clone().moveToFirstDayOfMonth().clearTime();j=e.clone().addMonths(1);}else{if(i.get("currentView")==="week"||i.get("currentView")==="day"){e=d.clone().addDays(-1).getFirstDayOfWeekView(Prefs.weekStart).clearTime();j=d.clone().addDays(1).getLastDayOfWeekView(Prefs.weekStart).clearTime();}else{e=d.getFirstDayOfMonthView(Prefs.weekStart).clearTime();j=d.getLastDayOfMonthView(Prefs.weekStart).clearTime();}}r=f.getDateRangeOfEventsInCache();if(r.startDate&&r.endDate){match=p.exec(r.startDate);if(match){c=new Date(match[2],match[3]-1,match[4]);}match=k.exec(r.endDate);if(match){n=new Date(match[2],match[3]-1,match[4]);}if(n&&c){q=n-c;if((q>=0)&&((q/(60*60*24*1000))>42)){h=true;}if(!h){e=c;j=n;Config.consoleLogger&&Config.consoleLogger("AutoRefreshing the WHOLE cache...");}else{Config.consoleLogger&&Config.consoleLogger("Only refreshing data for the CURRENT view... Purging the rest of the cache!");o=true;}}}return{startDate:e,endDate:j,purgeCache:o};},updateDataStore:function(n,d,i,m,k,l){var j=this,e=j.get("datastore"),g=j.get("datamodel"),h=false,f=false;if(m){Config.consoleLogger&&Config.consoleLogger("Attempting to load information from postLaunchDetails call!");}if(m){(!g.prefetchComplete)?(f=true):(f=false);}else{f=false;}if(!f){var c=(m)?"postLaunchDetails":"refresh data";Config.consoleLogger&&Config.consoleLogger("Loading... information from "+c+" call!");if(l){e.purgeEventStore();Config.consoleLogger&&Config.consoleLogger("Purging cache before loading new data...");}e.storeEvents(n,d,i);if(!m){g.fire("datamodel:eventsAvailable");}clearInterval(k.data);}}};b.namespace("calendar.model");b.calendar.model.autoRefresh=a;},"1.0.0",{requires:[]});YUI.add("calendar-notepad-model-note",function(b){var a=function(c){var e=this,d={uid:{value:""},folder:{value:null},description:{value:""},summary:{value:"",setter:function(f){if(b.Lang.trim(f)==""){return"[no title]";}else{return f.replace("&#39;","'");}}},SUMMARY:{setter:function(f){e.set("summary",f);}},DESCRIPTION:{setter:function(f){e.set("description",f);}},UID:{setter:function(f){e.set("uid",f+"");}}};b.augment(e,b.Attribute);e.addAttrs(d,c||{});};b.namespace("calendar.notepad.model");b.calendar.notepad.model.Note=a;},"1.0.0",{requires:["attribute-base","event-base","calendar-model-component"]});YUI.add("calendar-model-datamodel",function(f){var e=f.calendar.model.dataStore,d=(Config.isTardisEnabled)?f.calendar.model.calServiceTardis:f.calendar.model.calService,c=f.lib.Utils,b=f.lib.utils.Stats;var a=function(h){var j=this,i=Config.view||Prefs.initialView,g={currentDate:{value:(h&&Date.validateDate(h,"{MM}/{dd}/{yyyy}"))||new Date(),setter:function(k){return k;}},currentView:{value:Prefs.initialView,setter:function(){j.set("previousView",j.get("currentView"));}},currentTodoView:{value:Prefs.todoView||"priority"},currentMode:{value:(i==="list")?"list":"grid"},previousView:{value:Prefs.initialView},selectedNoteFolder:{value:"12"},selectedNote:{value:null},noteActiveEdit:{value:false}};j.fromCache=true;f.augment(j,f.Attribute);j.addAttrs(g);j.before("currentDateChange",function(k){j.fire("datamodel:dateChanging");if(!f.lib.utils.Stats.isLaunch&&"undefined"!=typeof(rt_Start)){rt_Start();}j.fromCache=true;});j.after("currentDateChange",function(k){j.fire("datamodel:dateChanged",k.newVal);j.updateEventStore();});j.before("currentViewChange",function(k){if(!f.lib.utils.Stats.isLaunch&&"undefined"!=typeof(rt_Start)){rt_Start();}});j.after("currentViewChange",function(k){j.fire("datamodel:viewChanged",k.newVal);j.makeViewSticky(k.newVal);});j.after("currentTodoViewChange",function(k){j.makeTodoViewSticky(k.newVal);});j.after("currentModeChange",function(k){j.fire("datamodel:modeChanged",k.newVal);});j.once("datamodel:foldersUpdated",function(k){j.getLaunchStatData();});j.on("datamodel:foldersUpdated",function(l){var m=this,k;k=m.getFolders({type:"EVENT"});if(k.length===1){Config.cfg.onlyOneFolder=true;}});j.on("datamodel:calTabVisible",function(k){Config.cfg.isCalTabVisible=k.details[0];if(k.details[0]){j.autoRefreshPlugin&&j.autoRefreshPlugin.startRefreshTimer(true);}});j.after("selectedNoteFolderChange",function(k){j.fire("datamodel:noteFolderChange",{type:"folder"});});j.after("selectedNoteChange",function(k){j.fire("datamodel:noteChange",{type:"note"});});j.prefetchComplete=false;j.autoRefreshPlugin=null;j.featurePromoter=null;j.groupsCalendarsAvailable=false;};a.prototype={init:function(g){var j=this,i;if(Config.isTardisEnabled){f.calendar.model.Event=f.calendar.model.TardisEvent;}if(j.checkIfAutoRefreshEnabled()){j.autoRefreshPlugin=new f.calendar.model.autoRefresh({datamodel:j,calservice:d,datastore:e});if(!Config.cfg.isCorp&&Config.isTardisEnabled){j.autoRefreshPlugin.startRefreshTimer();}}if(Config.partner==="ycorp"){j.storeConfRooms();}if(Config.cfg.promotionEnabled&&Config.yid){f.use("calendar-featurePromoter-controller",function(k){j.featurePromoter=k.calendar.featurePromoter;j.featurePromoter.init();});}if(g.data&&f.Object.size(g.data)!==0){j.processPrefetchedData(g.data);}else{if(Config.isProvisioned){j.updateFolderStore();}}if(Config.buildType=="prod"&&Config.isProvisioned&&Prefs.timezone==""){Prefs.timezone=Date.determine_timezone();j.updateTimezone(Prefs.timezone,null);}else{if(Config.buildType=="prod"&&Config.isProvisioned&&Config.cfg.isCorp){i=Date.determine_timezone();if(Prefs.timezone!=i){Prefs.timezone=i;j.updateTimezone(i,function(){b.addErrorLog("MLog:"+Config.yid+" Reloading with new timezone: "+i);window.location.search=window.location.search+"&tz="+i;});}}}f.use("lib-utils-errorHandler",function(l){var k=new l.lib.utils.ErrorHandler(j);});if(Config.context==="app"){f.use("calendar-model-messages",function(k){k.calendar.model.messages.init();});}c.cleanupCookie();window.onerror=function(m,l,k){b.addCounter("Error:JS");b.addErrorLog("MLog:"+JSON.stringify({yid:Config.yid,msg:"JSError: "+m+" @ "+l+":"+k}));};if(Prefs.timezone==="Etc/GMT"){var h=new Date();if(h.getTimezoneOffset()!==0){b.addErrorLog("MLog:"+JSON.stringify({yid:Config.yid,msg:"TimeZoneGMTError: "+h.getTimezoneOffset()}));}}if(Config.cfg.notificationsEnabled){f.use("lib-utils-notifications",function(){f.lib.Utils.notifications.setNotificationLoop();});}},checkIfAutoRefreshEnabled:function(){var g=this;return(Config.cfg.isCorp||(Config.isTardisEnabled&&Config.cfg.autoRefreshEnabled));},updateLaunchData:function(n){var m=this,g,k,r=[],j={},o=n.data&&n.data.events&&n.data.events.events,i=o&&o.uri,h=o&&o.syncToken,q=/dtstart=((....)(..)(..))/,l=/dtend=((....)(..)(..))/,p={};Config.consoleLogger&&Config.consoleLogger("Updating data store from pipe!");if(h){Config.consoleLogger&&Config.consoleLogger("Sync token in the flushed data! ... Setting sync token for the first time!");m.autoRefreshPlugin.set("synchToken",h);}else{Config.consoleLogger&&Config.consoleLogger("Making an API call to get sync token...");m.autoRefreshPlugin.checkSynchStatus(null,function(s){Config.consoleLogger&&Config.consoleLogger("Setting sync token for the first time!");});}if(i){match=q.exec(i);if(match){g=new Date(match[2],match[3]-1,match[4]);}match=l.exec(i);if(match){k=new Date(match[2],match[3]-1,match[4]);}}if(o){j.startDate=g;j.endDate=k;j.events=o.event;r=m.processEventResponse(j,null);p.data=setInterval(function(){m.autoRefreshPlugin.updateDataStore(r,g,k.clearTime().addDays(1).addMinutes(-1),true,p);m.autoRefreshPlugin.startRefreshTimer();},10);}},processPrefetchedData:function(C){var u=this,w,q={},t=null,A,B,g=[],s=[],x=[],o,p=u.get("currentDate"),r=/dtstart=((....)(..)(..))/,h=/dtend=((....)(..)(..))/,l=p.getFirstDayOfMonthView(Prefs.weekStart).clearTime(),z=p.getLastDayOfMonthView(Prefs.weekStart).clearTime().addDays(1).addMinutes(-1),n=null;if(C.grpdiscovery&&C.grpdiscovery.discovered&&C.grpdiscovery.discovered.ts&&C.grpdiscovery.discovered.ts.length&&C.grpdiscovery.discovered.ts.length>0){u.groupsCalendarsAvailable=true;}if(Config.product==="notepad"){if(Config.isTardisEnabled){n=null;if(C.folders&&C.folders.folders){if(C.folders.folders.count===0){C.folders.folders.folder=[];}C.folders.folders.folder.push({id:"12",type:"JOURNAL",name:strings.str_cal_np_default_folder_name});C.folders.folders.count++;for(w in C.folders.folders.folder){if(C.folders.folders.folder[w].id==="16"){n=w;break;}}if(n){C.folders.folders.folder.splice(n,1);C.folders.folders.count--;}}}else{n=null;if(C.folders&&C.folders.RESPONSE&&C.folders.RESPONSE.VALUE){C.folders.folders={};C.folders.folders.folder=C.folders.RESPONSE.VALUE;C.folders.folders.count=C.folders.folders.folder.length;for(w in C.folders.folders.folder){if(C.folders.folders.folder[w].FOLDER_ID===16){n=w;continue;}C.folders.folders.folder[w]=u.convertFolderV1toV2(C.folders.folders.folder[w]);}C.folders.folders.folder.push(u.convertFolderV1toV2({FOLDER_TYPE:"JOURNAL",FOLDER_ID:12,FOLDER_NAME:strings.str_cal_np_default_folder_name}));C.folders.folders.count++;if(n){C.folders.folders.folder.splice(n,1);C.folders.folders.count--;}}}}if(C.folders&&C.folders.folders&&C.folders.folders.count){A=C.folders.folders.folder;if("efid" in Config.args&&"eid" in Config.args){t={};B=Config.args.efid.split(",");for(w in B){t[B[w]]=1;}}if((Config.product!=="notepad")&&((Config.partner=="ycorp"||Config.cfg.isCorp)&&!Config.isTardisEnabled)){t={"133":1};if(Config.cfg.sportsEnabled){for(w=0;w<A.length;w++){if(A[w].isRemote){t[A[w].id]=1;}}}}for(w=0;w<A.length;w++){if(t==null||(A[w].isRemote&&A[w].owner==Config.args.eid&&A[w].remoteId in t)||(A[w].id in t&&Config.cfg.isCorp)||("efid" in Config.args&&"eid" in Config.args&&A[w].id in t&&A[w].owner==Config.args.eid)){if(C.myfolders&&C.myfolders.folders&&C.myfolders.folders.count){for(var v in C.myfolders.folders.folder){if(C.myfolders.folders.folder[v].owner==A[w].owner&&C.myfolders.folders.folder[v].isRemote&&C.myfolders.folders.folder[v].color){A[w].color=C.myfolders.folders.folder[v].color;break;}}}q[A[w].id]=new f.calendar.model.Folder(A[w]);}}if("efid" in Config.args&&"eid" in Config.args){if(f.Object.size(q)==0){var m=window.location.protocol+"//calendar.yahoo.com/"+Config.args.eid+"?",k=[];delete Config.args.efid;delete Config.args.eid;for(w in Config.args){k.push(w+"="+Config.args[w]);}window.location=m+k.join("&");}else{var y=false;for(w in q){if(q[w].get("isReadOnly")==false){y=true;break;}}if(!y){Config.cfg.rw=false;Config.cfg.optionsNoAccess=true;u.fire("datamodel:confChanged");}}}e.storeFolders(q);u.fire("datamodel:foldersUpdated");if(t){d.filterFolders=q;u.prefetchComplete=true;}}setTimeout(function(){if(Config.product==="notepad"){if(Config.isTardisEnabled){if(C.notes&&C.notes.journals){if(C.notes.journals.count>0){s=u.processNoteResponse(C.notes.journals.journal);}e.storeNotes(s,["12"]);u.fire("datamodel:notesAvailable");}}else{if(C.notes&&C.notes.RESPONSE&&C.notes.RESPONSE.VALUE){if(C.notes.RESPONSE.VALUE.length>0){s=u.processNoteResponse(C.notes.RESPONSE.VALUE);}e.storeNotes(s,["12"]);u.fire("datamodel:notesAvailable");}}}if(C.todos&&C.todos.todos&&(C.todos.todos.count>=0)){if(C.todos.todos.count===0){u.fire("datamodel:todosAvailable");}else{x=u.processTodoResponse({todos:C.todos.todos.todo});if(x){e.storeTodos(x,null);u.fire("datamodel:todosAvailable");}}}setTimeout(function(){if(C.events&&C.events.events){if(C.events.events.count){g=u.processEventResponse({events:C.events.events.event});}if(C.trash&&C.trash.events&&C.trash.events.count){g=g.concat(u.processEventResponse({events:C.trash.events.event}));d.filterFolders=q;u.fire("datamodel:foldersUpdated");}if(!g){g=[];}if(C.events.events.uri){o=r.exec(C.events.events.uri);if(o){l=new Date(o[2],o[3]-1,o[4]);}o=h.exec(C.events.events.uri);if(o){z=new Date(o[2],o[3]-1,o[4]);z.clearTime().addDays(1).addMinutes(-1);}}e.storeEvents(g,l,z);u.fire("datamodel:eventsAvailable");}if(C.event&&C.event.event){g=u.processEventResponse({events:[C.event.event]});if(!g){g=[];}e.storeEvents(g,l,z,true);u.fire("datamodel:eventsAvailable");}u.prefetchComplete=true;},5);},5);if(C.event&&C.event.event){g=u.processEventResponse({events:[C.event.event],ignoreFolder:true});if(g){e.storeEvents(g,g[0].get("startTime").clone().clearTime(),g[0].get("endTime").clone().clearTime());u.fire("datamodel:eventsAvailable");}}else{if(C.event&&C.event.events){if(C.event.events.count){g=u.processEventResponse({events:C.event.events.event,ignoreFolder:true});}if(!g){g=[];}e.storeEvents(g,l,z,true);u.fire("datamodel:eventsAvailable");}}},getLaunchStatData:function(){var h=this,g=e.getLaunchStatData();b.addOneTimeStat("Count:ownedCalendars",(g.totalOwnedCalendars<=25)?g.totalOwnedCalendars:26);b.addOneTimeStat("Count:friendsCalendars",(g.totalFriendsCalendars<=25)?g.totalFriendsCalendars:26);b.addOneTimeStat("Count:subscribedCalendars",(g.totalSubscribedCalendars<=25)?g.totalSubscribedCalendars:26);b.addOneTimeStat("Count:holidayCalendars",(g.totalHolidayCalendars<=25)?g.totalHolidayCalendars:26);},handleAPIError:function(h,i){var m=this,p,n=null,k=h.responseText,l=false,g=false;if(i){l=i.showCaptcha;g=i.handleAlways;}m.fire("datamodel:Exception");if(Config.product==="notepad"&&h.responseText.RESPONSE&&h.responseText.RESPONSE["CODE"]){p=h.responseText.RESPONSE["CODE"];b.addCounter("Notepad:Error:WS1Call:"+p);m.fire("datamodel:APIError",p);return;}if(h.status===402&&l){if(k.responseText&&k.responseText.captcha){b.addCounter("Error:WSCall:Captcha");m.fire("datamodel:captcha401",h);}}else{if(h.status===302||h.status===401){b.addCounter("Error:WSCall:Relogin");c.relogin();}else{if(h.status===0){if(h.statusText==="timeout"){b.addCounter("Error:WSCall:TimedOut");p="TimedOut";m.fire("datamodel:APIError",p);b.addErrorLog("MLog:"+JSON.stringify({yid:Config.yid,msg:"error:TimedOut url:"+h.requestedURL+" operation:"+h.requestedOp+" timestamp:"+(new Date()).toString()}));}else{b.addCounter("Error:WSCall:NoErrorCode:Status0");p="Status0";m.fire("datamodel:APIError",p);b.addErrorLog("MLog:"+JSON.stringify({yid:Config.yid,msg:"error:Status0 url:"+h.requestedURL+" operation:"+h.requestedOp+" timestamp:"+(new Date()).toString()+" dump: "+f.JSON.stringify(h)}));}}else{if(h.status===413){p="413";b.addCounter("Error:WSCall:413");m.fire("datamodel:APIError",p);}else{if(h.status===403&&k.responseText&&k.responseText.error&&k.responseText.error.ec1&&k.responseText.error.ec1==4032){p=k.responseText.error.ec1+":"+k.responseText.error.ec2;n=(k.responseText.error.detail)?(k.responseText.error.detail):null;b.addCounter("Error:WSCall:"+p);m.fire("datamodel:blockAbuse4032",h);}else{if(h.status===403&&k.responseText&&k.responseText.calendarError&&k.responseText.calendarError.code&&k.responseText.calendarError.code==4031){p=4031;n=(k.responseText.calendarError.detail)?(k.responseText.calendarError.detail):null;b.addCounter("Error:WSCall:"+p);m.fire("datamodel:blockAbuse4032",h);}else{if(h.status===403&&k.responseText&&k.responseText.error&&k.responseText.error.ec1&&k.responseText.error.ec1===4030&&k.responseText.error.ec2&&k.responseText.error.ec2==="C408"){p=k.responseText.error.ec1+":"+k.responseText.error.ec2;b.addCounter("Error:WSCall:"+p);m.fire("datamodel:APIError","C408");}else{if(!l||g){if(k.error==="JSON Parse Error"){p="1111";b.addCounter("Error:WSCall:JSONParse");}else{if((k.responseText&&k.responseText.calendarError)||Config.isTardisEnabled){var j="";if(k.responseText.calendarError.code&&k.responseText.calendarError.code!=0){j=":"+k.responseText.calendarError.code;}p=h.status+j;b.addCounter("Error:WSCall:"+p);b.addErrorLog("MLog:"+JSON.stringify({yid:Config.yid,msg:"error:"+p+" url:"+h.requestedURL+" operation:"+h.requestedOp+" timestamp:"+(new Date()).toString()+((h.WSHost)?(" WSHost:"+h.WSHost):"")}));}else{if(k.responseText&&k.responseText.error&&k.responseText.error.ec1){p=k.responseText.error.ec1+":"+k.responseText.error.ec2;n=(k.responseText.error.detail)?(k.responseText.error.detail):null;b.addCounter("Error:WSCall:"+p);}else{if(k.responseText&&k.responseText.error&&k.responseText.error.description){p=(k.responseText.error.description.split(":")[0])?(k.responseText.error.description.split(":")[0]):"0000";n=(k.responseText.error.detail)?(k.responseText.error.detail):null;b.addCounter("Error:WSCall:NoErrorCode:"+p);b.addErrorLog("MLog:"+JSON.stringify({yid:Config.yid,msg:"error:noErrorCode:"+p+" url:"+h.requestedURL+" operation:"+h.requestedOp+" timestamp:"+(new Date()).toString()+((h.WSHost)?(" WSHost:"+h.WSHost):"")}));}else{p="0000";b.addCounter("Error:WSCall:NoErrorCode:"+p);b.addErrorLog("MLog:"+JSON.stringify({yid:Config.yid,msg:"error:noErrorCode:0000 url:"+h.requestedURL+" operation:"+h.requestedOp+" timestamp:"+(new Date()).toString()+((h.WSHost)?(" WSHost:"+h.WSHost):"")}));}}}}m.fire("datamodel:APIError",p,n);}}}}}}}}},updateEventStore:function(i){var k=this,h=i||k.get("currentDate"),g,j=null;k.showToast();if(!k.prefetchComplete){return;}if(k.get("currentView")==="list"){g=h.clone().moveToFirstDayOfMonth().clearTime();if(!e.hasNumEvents(g,100)){if((g-k.get("currentDate"))/86400000<90){j=g.clone().addMonths(1);}}}else{if(k.get("currentView")==="week"||k.get("currentView")==="day"){g=h.getFirstDayOfWeekView(Prefs.weekStart).clearTime().addDays(-1);j=h.getLastDayOfWeekView(Prefs.weekStart).clearTime().addDays(1);if(e.hasEvents(g.clone(),j)){j=null;}}else{g=h.getFirstDayOfMonthView(Prefs.weekStart).clearTime();j=h.getLastDayOfMonthView(Prefs.weekStart).clearTime();if(e.hasEvents(g,j)){j=null;}}}if(j!==null){d.getEvents({dtstart:g,dtend:j},{success:function(m){var l=k.processEventResponse(m,i);if(!l){l=[];}k.fromCache=false;e.storeEvents(l,m.startDate,m.endDate.clearTime().addDays(1).addMinutes(-1));k.updateEventStore(i);},failure:function(l){b.addCounter("Error:getEvents");k.handleAPIError(l);}});}else{k.fire("datamodel:eventsAvailable");}},prefetchNextSet:function(){var j=this,h=j.get("currentDate"),g,i=null;if(j.get("currentView")==="week"||j.get("currentView")==="day"){g=h.getFirstDayOfWeekView(Prefs.weekStart).clearTime().addDays(6);i=h.getLastDayOfWeekView(Prefs.weekStart).clearTime().addDays(8);if(e.hasEvents(g.clone(),i)){i=null;}}if(i!==null){d.getEvents({dtstart:g,dtend:i},{success:function(l){var k=j.processEventResponse(l);if(!k){k=[];}j.fromCache=false;e.storeEvents(k,l.startDate,l.endDate.clearTime().addDays(1).addMinutes(-1));},failure:function(k){}});}},processEventResponse:function(m,g){var o=this,r=[],h,k,n,p,l,s=/(....)(..)(..)T(..)(..)(..)/,q=/(....)(..)(..)/;if(m){for(l=0;l<m.events.length;l++){p=m.events[l];h=m.events[l].folderId;if(Config.isEntityView&&h.indexOf(":")!=-1){h=e.getLocalFolderId(Config.args.efid,Config.args.eid);}else{if(Config.owner&&h.indexOf(":")!=-1){h=h.substring(h.indexOf(":")+1);}}if(h==132){h=131;}if(p.url){if(p.description){p.description=p.description+"\n **"+strings.str_cal_calurl+" "+p.url+" **";}}p.folder=e.getFolder(h*1);if(!p.folder&&h==3){p.folder=new f.calendar.model.Folder({id:3,name:"Trash",color:"red",folderCheck:true,type:"EVENT",isRemote:false});e.addFolder(p.folder);}if(!p.folder&&!m.ignoreFolder){f.log("Folder data has not been loaded for: "+p.folderId);if(p.folderId===131){return;}continue;}if(!(p.startTime&&p.endTime)||((p.startTime==p.endTime)&&(p.allDay==="false"))){continue;}if(!(p.startTime instanceof Date)){n=s.exec(p.startTime);if(n===null){n=q.exec(p.startTime);n=n.concat([0,0,0]);}p.startTime=new Date(n[1]*1,n[2]-1,n[3]*1,n[4]*1,n[5]*1,n[6]*1);}if(!(p.endTime instanceof Date)){n=s.exec(p.endTime);if(n===null){n=q.exec(p.endTime);n=n.concat([0,0,0]);}p.endTime=new Date(n[1]*1,n[2]-1,n[3]*1,n[4]*1,n[5]*1,n[6]*1);}if(p.allDay=="true"&&p.endTime.equals(p.startTime)){p.endTime=p.endTime.addDays(1);}else{if(p.endTime.isBefore(p.startTime)||(p.endTime.equals(p.startTime))){p.endTime=p.startTime.clone().addHours(1);}}if(p.recurrence&&p.recurrence.numInstances){p.recurrence.count=p.recurrence.numInstances;}if(p.reminders&&p.reminders.count>0){for(k in p.reminders.reminder){if(p.reminders.reminder[k].sendEmail){p.reminders.reminder[k].email=Prefs.reminderEmail;}if(p.reminders.reminder[k].sendIM){p.reminders.reminder[k].messenger=true;}}}if(!g){r.push(new f.calendar.model.Event(p));}else{if(g==="V3"){r.push(new f.calendar.model.TardisEvent(p));}}}return r;}return null;},getEventUrl:function(h,g){return d.getEvents({uids:h.get("uid"),urlType:g.type});},getEventDetails:function(i,g,h){var j=this;d.getEventDetails(i,{success:function(l){var k;l.ignoreFolder=true;k=j.processEventResponse(l);if(k.length>0){j.fire("datamodel:eventAvailable",k[0]);if(g&&g.success){g.success(k[0]);}}},failure:function(k){j.fire("datamodel:eventNotFound");b.addCounter("Error:getEvents");if(g&&g.failure){g.failure();}if(!(h&&h.dontHandleError)){j.handleAPIError(k);}}});},getRichEvent:function(i,g){var j=this,h=f.calendar.model.calServiceTardis;if(e.getRichEvent(i.uid,i.owner)!==null){return g.success(e.getRichEvent(i.uid,i.owner));}h.getEventDetails({uid:i.uid,owner:i.owner},{success:function(l){var k;l.ignoreFolder=true;k=j.processEventResponse(l,"V3");if(k.length>0){e.storeRichEvent(k[0],i.uid,i.owner);if(g&&g.success){g.success(k[0]);}}},failure:function(k){j.fire("datamodel:eventNotFound");b.addCounter("Error:getEvents");if(g&&g.failure){g.failure();}j.handleAPIError(k);}});},updateEvents:function(l,r){var v=this,u=l.eids,o=l.updates,g,y,m,q,s,x,t,n=null,k,j,p,w,h=[];t={};if(l.isSearch){t.folder="search";}q=v.getEventsByUID(u[0].uid,t)[0];if(o.folderId){g=o.folderId;m=v.getFolders({id:g})[0];y=q.get("folder").get("id");if(y!==g){s=y;x=g;}if(s&&x){if(u[0].recurId){delete u[0].recurId;}}}l=l||{};if("startTime" in o){o.startTime=o.startTime.toString("yyyyMMddTHHmmss");}if("endTime" in o){o.endTime=o.endTime.toString("yyyyMMddTHHmmss");}j=u[0].uid;if(!l.split&&u[0].recurId){p=u[0].recurId;}for(w=0;w<u.length;w++){h.push({event:f.merge(u[w],o)});}if(u.length==1){if(u[0].recurId){t.recurId=u[0].recurId;k=e.getEventsByUID(u[0].uid,t)[0];}else{k=e.getEventsByUID(u[0].uid,t)[0];}if(Config.cfg.isCorp){n=k.get("ICalExchangeId");}}d.updateEvents(h,{partial:l.partial,split:l.split,captchaData:l.captchaData,src_folder_id:s,target_folder_id:x},{success:function(C){var H={},F,D,B,A,G,E,z;if(s&&x&&!l.split){C={events:[]};z=q.simplify();for(B in o){if(B==="summary"||B==="location"||B==="description"){z.event[B]=c.escapeHtml(o[B]);}else{z.event[B]=o[B];}}C.events.push(z.event);}H=v.processEventResponse(C);if(l.isSearch){for(B in H){E=(u[B].recurId)?u[B].recurId:null;if(E||!H[B].get("isRecurring")){e.updateObjectsFromSearchResults("UPDATE",H[B].get("uid"),E,H[B]);}else{v.fire("datamodel:searchAgain");if(r&&r.success){r.success();}return;}}if(r&&r.success){r.success();}f.fire("datamodel:searchEventsAvailable");e.purgeEventStore();v.updateEventStore();return;}if("startTime" in o||"endTime" in o){for(B=0;B<H.length;B++){D=H[B];if(!l.split){if(D.get("isException")){e.removeEvent(D.get("uid"),p);e.addEvent(D);v.fire("datamodel:eventsAvailable");}else{if(D.get("isRecurring")){if(Config.cfg.isCorp){e.removeEventsByExId(D.get("ICalExchangeId"));}else{e.removeEvent(D.get("uid"));}v.getRecurringEvents({uid:D.get("uid"),fid:D.get("folder").get("id")},D);v.fire("datamodel:eventsAvailable");}else{e.removeEvent(D.get("uid"));e.addEvent(D);v.fire("datamodel:eventsAvailable",D);}}}else{if(Config.cfg.isCorp){e.removeEventsByExId(n,D.get("startTime").clearTime());}else{e.removeEvent(j);v.getRecurringEvents({uid:j,fid:q.get("folder").get("id")});}v.getRecurringEvents({uid:D.get("uid"),fid:D.get("folder").get("id")},D);}}}else{F=H[0];for(B=0;B<u.length;B++){if("recurId" in u[B]){H=e.getEventsByUID(u[B].uid,{recurId:u[B].recurId});}else{H=e.getEventsByUID(u[B].uid);}for(A=0;A<H.length;A++){for(G in o){if(G==="folderId"){G="folder";}H[A].set(G,F.get(G));}}}v.fire("datamodel:eventsAvailable",H[0]);}if(r&&r.success){r.success();}},failure:function(i){e.removeEvent("tempObject");if(r&&r.failure()){r.failure();}v.fire("datamodel:eventsAvailable");b.addCounter("Error:updateEvents");v.handleAPIError(i,{showCaptcha:true,handleAlways:true});}});},getEventsByUID:function(h,g){return e.getEventsByUID(h,g);},getObjectsFromSearchResults:function(h,g){return e.getObjectsFromSearchResults(h,g);},updateObjectsFromSearchResults:function(g,h,i){e.updateObjectsFromSearchResults(g,h,i);},getEventsByDateRange:function(g,h){return e.getEventsByDateRange(g,h);},getOrFetchEventsByDateRange:function(h,i,g){var j=this;if(e.hasEvents(h,i)){g&&g.success&&g.success(e.getEventsByDateRange(h,i));}else{d.getEvents({dtstart:h,dtend:i},{success:function(l){var k=j.processEventResponse(l);if(!k){k=[];}j.fromCache=false;e.storeEvents(k,l.startDate,l.endDate.clearTime().addDays(1).addMinutes(-1));g&&g.success&&g.success(e.getEventsByDateRange(h,i));},failure:function(k){b.addCounter("Error:getEvents");j.handleAPIError(k);g&&g.failure&&g.failure(k);}});}},addEvent:function(j,l,i){var p=this,q=j.eventObj,g,k,h,n,o=d,m=false;if(i&&(i==="V3")){o=f.calendar.model.calServiceTardis;m=true;}if(j.isSimplified){g=q;}else{g=q.simplify();}if(g.event.attendees&&g.event.attendees.attendee&&(g.event.attendees.attendee.length>0)){n=(g.event.attendees.attendee.length<=40)?g.event.attendees.attendee.length:40;}k=g.event.folderId;h=p.getFolders({id:k})[0];j=j||{};o.addEvent(g,{captchaData:j.captchaData,setdefrem:j.setdefrem},{success:function(u){var s={},r,t;b.addCounter("createInvite:noOfAttendees:"+n);if(m){s=p.processEventResponse(u,"V3");}else{s=p.processEventResponse(u);}e.removeEvent("tempObject");for(r=0;r<s.length;r++){t=s[r];if(t.get("isRecurring")){p.getRecurringEvents({uid:t.get("uid"),fid:t.get("folder").get("id")});b.addCounter("addEvent:isRepeating");}else{e.addEvent(t);}if(t.get("reminders").count){b.addCounter("addEvent:hasReminders");}}p.fire("datamodel:eventsAvailable",t);if(l&&l.success){l.success(t);}},failure:function(r){e.removeEvent("tempObject");p.fire("datamodel:eventsAvailable");if(l&&l.failure){l.failure();}if(!(r.status===401&&r.responseText&&r.responseText.responseText&&r.responseText.responseText.captcha)){b.addCounter("Error:addEvent");}p.handleAPIError(r,{showCaptcha:true,handleAlways:true});}});if(!j.isSimplified&&!q.get("isRecurring")||(j.isSimplified&&j.isRecurring)){q.set("uid","tempObject");q.set("summary",c.escapeHtml(q.get("summary")));q.set("location",c.escapeHtml(q.get("location")));q.set("description",c.escapeHtml(q.get("description")));e.addEvent(q);p.fire("datamodel:eventsAvailable",q);}},deleteFolder:function(h,g){var k=this,j={type:"folder",id:h},i=d;if(Config.cfg.isCorp){i=f.calendar.model.calServiceTardis;}i.deleteFolder(j,{success:function(){e.removeFolder(j);k.updateEventStore();k.updateTodoStore("allNotDone");k.fire("datamodel:foldersUpdated");k.fire("datamodel:eventsAvailable");k.fire("datamodel:calendarDeleted");g&&g.success&&g.success();},failure:function(l){b.addCounter("Error:deleteFolder");k.handleAPIError(l);g&&g.failure&&g.failure();}});},deleteFolderEvents:function(h,g){var j=this,i={type:"events",id:h};d.deleteFolder(i,{success:function(){e.removeFolder(i);j.updateEventStore();j.updateTodoStore("allNotDone");j.fire("datamodel:foldersUpdated");j.fire("datamodel:eventsAvailable");g.success&&g.success();},failure:function(k){b.addCounter("Error:deleteFolderEvents");j.handleAPIError(k);g.failure&&g.failure();}});},deleteEventByUid:function(k,g,n){var o=this,j,m,h=k.split(","),l={success:function(){o.updateEventStore();for(j in h){e.removeEvent(h[j]);}o.fire("datamodel:eventsAvailable");g.success&&g.success();},failure:function(i){b.addCounter("Error:deleteEventByUid");o.handleAPIError(i);g.failure&&g.failure();}};if(n&&h.length==1){m={events:[{event:{uid:h[0]}}],repeat:"single"};d.deleteEvents(m,l,n);}else{d.deleteEventsByUids(h,l);}},deleteEvents:function(o,m){var j=this,k=o[0].event.uid,i,g,h=null,l,n={events:o,repeat:"single"};if(m){l=e.getObjectsFromSearchResults(k)[0];}else{l=e.getEventsByUID(k)[0];}i=l.get("folder").get("id");g=j.getFolders({id:i})[0];d.deleteEvents(n,{success:function(r){var q,p=r.events;for(q in p){if(!m){e.removeEvent(p[q]["event"]["uid"],p[q]["event"]["rid"]);}}if(m){j.fire("datamodel:searchAgain");}else{j.fire("datamodel:eventsAvailable");}},failure:function(p){b.addCounter("Error:deleteEvents");j.handleAPIError(p);}},i);},deleteEventsSeries:function(o,i,m){var j=this,k=o[0].event.uid,h,g,l,n={events:o,repeat:"all"};if(m){l=e.getObjectsFromSearchResults(k)[0];}else{l=e.getEventsByUID(k)[0];}h=l.get("folder").get("id");g=j.getFolders({id:h})[0];d.deleteEvents(n,{success:function(r){var q,p=r.events;for(q in p){if(!m){if(Config.cfg.isCorp&&l.get("isRecurring")&&l.get("ICalExchangeId")){e.removeExchangeSeries(l.get("ICalExchangeId"));Config.consoleLogger&&Config.consoleLogger("Removing Exchange recurring series based on the ICalExchangeId...");}else{e.removeEvent(p[q]["event"]["uid"]);}}}if(m){j.fire("datamodel:searchAgain");}else{j.fire("datamodel:eventsAvailable");}},failure:function(p){b.addCounter("Error:deleteEvents");j.handleAPIError(p);}},h);},deleteEventsBatch:function(l,g){var m=this,h=l.events,i=l.type,k=h.events.event,j;d.deleteEventsBatch(h,{success:function(p){var n;if(i==="SEARCH"){for(n in k){m.updateObjectsFromSearchResults("DELETE",k[n].id,k[n].recurId);}f.fire("datamodel:searchEventsAvailable");e.purgeEventStore();m.updateEventStore();}else{for(n in k){if(Config.cfg.isCorp&&!k[n].recurId){j=e.getEventsByUID(k[n].id)[0];e.removeExchangeSeries(j.get("ICalExchangeId"));Config.consoleLogger&&Config.consoleLogger("Removing Exchange recurring series based on the ICalExchangeId...");}else{e.removeEvent(k[n].id,k[n].recurId);}}m.fire("datamodel:eventsAvailable");}},failure:function(n){b.addCounter("Error:deleteEventsBatch");m.handleAPIError(n);}});},moveEventsBatch:function(g,h){var i=this;d.moveEventsBatch(g,{success:function(p){var k,n,l,m=g.events.event;if(h==="SEARCH"){for(n in m){k=i.getObjectsFromSearchResults(m[n].id);for(l in k){k[l].set("folder",i.getFolders({id:m[n].folderId})[0]);}}f.fire("datamodel:searchEventsAvailable");e.purgeEventStore();i.updateEventStore();}else{for(n in m){k=i.getEventsByUID(m[n].id);for(l in k){k[l].set("folder",i.getFolders({id:m[n].folderId})[0]);}}i.fire("datamodel:eventsAvailable");}},failure:function(j){b.addCounter("Error:moveEventsBatch");i.handleAPIError(j);}});},updateFolderStore:function(h){var i=this,g={success:function(j){e.storeFolders(j);i.fire("datamodel:foldersUpdated");i.updateEventStore();i.updateTodoStore(null);},failure:function(j){b.addCounter("Error:getFolders");i.fire("datamodel:foldersCallError");i.handleAPIError(j);}};if(h){g.success(h);}else{d.getFolders({},g);}},getFolders:function(i,h,g){if(h){d.getFolders({},{success:function(j){g&&g.success&&g.success(j);},failure:function(j){b.addCounter("Error:getFolders");g&&g.failure&&g.failure();}});}else{return e.getFolders(i);}},getActiveFolder:function(k){var g,m=this,l,j={type:"EVENT",isRemote:false,isReadOnly:false},h=m.getFolders(j);h.sort(function(n,i){var p=n.get("name"),o=i.get("name");if(p<o){return -1;}if(p>o){return 1;}return 0;});l=h[0];for(g in h){if(h[g].get("isActive")=="true"){l=h[g];break;}}return l;},createFolder:function(h,g){var k=this,j=false,i=d;if(Config.cfg.isCorp&&h.folder.reminderSettings){i=f.calendar.model.calServiceTardis;}j=k.checkIfNameAlreadyUsed(h.folder.name);if(h.folder.owner&&(h.folder.owner.search("@@groups")===0)){h.folder.name=k.getAlternateFolderName(h.folder.name);}else{if(j){k.fire("datamodel:APIError","SAME_FOLDER_NAME");return;}}i.createFolder(h,{success:function(l){var m=new f.calendar.model.Folder(l);e.addFolder(m);if(l.type=="EVENT"){e.purgeEventStore();k.updateEventStore();}else{k.updateTodoStore(null);}if(Config.product==="notepad"){k.set("selectedNoteFolder",m.get("id"));}g&&g.success&&g.success(l);k.fire("datamodel:foldersUpdated");},failure:function(l){b.addCounter("Error:addFolder");k.handleAPIError(l);g&&g.failure&&g.failure();}});},refreshSubscribedCalendar:function(h,g){var i=this;i.updateFolder(h,g,null,{success:function(){e.purgeEventStore();}});},updateFolder:function(l,i,k,g){var n=this,h,m,j=d;if(Config.cfg.isCorp&&i.reminderSettings){j=f.calendar.model.calServiceTardis;}h={folder:f.merge(i)};h.folder.id=l;m=n.checkIfNameAlreadyUsed(h.folder.name,l);if(m){n.fire("datamodel:APIError","SAME_FOLDER_NAME");g&&g.failure&&g.failure();return;}if((h.folder.folderCheck!==null)&&(h.folder.folderCheck!==undefined)){if(h.folder.folderCheck!=="sync"){h.folder.folderCheck?(h.folder.folderCheck="check"):(h.folder.folderCheck="uncheck");}}j.editFolder(k,h,{success:function(o){var p,r,q,s;r=e.getFolders({id:l})[0];if(!k){for(p in i){if(p!=="grants"){r.set(p,i[p]);}else{r.set("grants",o.grants);}}}else{if(k){if(k==="ics"){r.set("icsToken",o.icsToken);}else{if(k==="web"){r.set("webToken",o.webToken);}}n.fire("datamodel:updateToken",k);}}if(typeof i.folderCheck!=="undefined"){if(i.folderCheck){e.purgeEventStore();n.updateEventStore();s="calendarTurnedOn:";}else{n.fire("datamodel:eventsAvailable");if(e.checkDoneTodoStatus()){n.updateTodoStore("done");}s="calendarTurnedOff:";}if(r.get("isRemote")){if(r.get("owner")===Config.holidayAccount){q="holidayCalendar";}else{q="friendsCalendar";}}else{if(r.get("url")){q="subscribedCalendar";}else{q="ownedCalendar";}}b.addCounter(s+q);}else{if(i.color){n.fire("datamodel:eventsAvailable");if(e.checkDoneTodoStatus()){n.updateTodoStore("done");}}else{if(i.reminderSettings){r.set("reminderSettings",i.reminderSettings);}}}if(g&&g.success){g.success();}n.fire("datamodel:foldersUpdated");},failure:function(p){b.addCounter("Error:updateFolder");n.handleAPIError(p);if(g&&g.failure){g.failure();}}});},updateTodoStore:function(g){var h=this;d.getTodos(g,{success:function(j){var i;i=h.processTodoResponse(j);if(i){e.storeTodos(i,g);if(g!==null){h.fire("datamodel:todosAvailable",g);}else{h.fire("datamodel:todosAvailable");}}},failure:function(i){b.addCounter("Error:getTodos");h.handleAPIError(i);}});},processTodoResponse:function(l){var n=this,h=[],g,k,j,m;if(l){for(j=0;j<l.todos.length;j++){k=l.todos[j];m=k.folderId;if(l.isSearch&&(k.completedOn||k.status==="COMPLETED")){continue;}if(Config.isEntityView&&m.indexOf(":")!=-1){m=e.getLocalFolderId(Config.args.efid,Config.args.eid);}k.folder=e.getFolders({id:m})[0];if(!k.folder){f.log("Folder data has not been loaded for: "+k.folderId);if(k.folderId===131){return;}continue;}if(k.dueOn){g=k.dueOn.match(/(....)(..)(..)T(..)(..)(..)/);if(g===null){g=k.dueOn.match(/(....)(..)(..)/);g=g.concat([0,0,0]);}k.dueOn=new Date().set({year:g[1]*1,month:g[2]-1,day:g[3]*1,hour:g[4]*1,minute:g[5]*1,second:g[6]*1});}if(k.completedOn){g=k.completedOn.match(/(....)(..)(..)T(..)(..)(..)/);if(g===null){g=k.completedOn.match(/(....)(..)(..)/);g=g.concat([0,0,0]);}k.completedOn=new Date().set({year:g[1]*1,month:g[2]-1,day:g[3]*1,hour:g[4]*1,minute:g[5]*1,second:g[6]*1});}k.allday=k.allDay;h.push(new f.calendar.model.Todo(k));}return h;}return null;},getTodos:function(g){var i=this,h=e.getTodos(g);if(h.length===0){if(g==="done"&&!(e.checkDoneTodoStatus())){i.updateTodoStore(g);}else{if(g!=="done"){i.updateTodoStore(g);}}return null;}else{return h;}},getTodo:function(g){return e.getTodo(g);},addTodo:function(l,g){var m=this,j=l.type,i=l.postData,h=i.todo.folderId,k=m.getFolders({id:h})[0];d.addTodo(i,{success:function(o){var n;n=m.processTodoResponse(o);if(n[0]){e.addTodo(n[0],j);if(n[0].get("status")!=="COMPLETED"){m.fire("datamodel:updateTodo",{action:"add",uid:n[0].get("uid"),change:{notDone:"update",done:null},targetNode:null});}else{m.fire("datamodel:todosAvailable","done");}}},failure:function(n){b.addCounter("Error:addTodo");m.handleAPIError(n);}});},updateTodo:function(n,l){var r=this,j,k,p,h,o={},m=[],g=n.postData,s=n.target,t=n.updateStore,q=n.mode;for(p in g){j=g[p].todo.folderId;h=r.getFolders({id:j})[0];k=r.getTodo(g[p].todo.uid).get("folder").get("id");if(k!==j){m[p]={src_folder_id:k,target_folder_id:j};}}d.updateTodo(g,{success:function(z){var v,u,y,B,x,w={};function A(E){var C;C=Date.validateDate(E);if(C){return C;}if(!/^(\d){8}$/.test(E)){return false;}var F=E.substr(0,4),i=E.substr(4,2),D=E.substr(6,2);return new Date(F,i-1,D);}if(q==="SEARCH"){e.updateObjectsFromSearchResults("UPDATE",null,null,r.processTodoResponse(z)[0]);f.fire("datamodel:searchEventsAvailable");return;}if(l&&(typeof(l)=="function")){if(m[0]){v=r.getTodo(g[0].todo.uid).clone();for(x in g[0].todo){if(x==="folderId"){v.set("folder",r.getFolders({id:g[0].todo[x]})[0]);}else{if(x=="dueOn"){v.set("dueOn",A(g[0].todo[x]));}else{v.set(x,g[0].todo[x]);}}}u=[];u[0]=v;}else{u=r.processTodoResponse(z);}l(u[0]);f.fire("datamodel:searchEventsAvailable");return;}if(t){if(m[0]){v=r.getTodo(g[0].todo.uid).clone();for(x in g[0].todo){if(x==="folderId"){v.set("folder",r.getFolders({id:g[0].todo[x]})[0]);}else{if(x=="dueOn"){v.set("dueOn",A(g[0].todo[x]));}else{v.set(x,g[0].todo[x]);}}}u=[];u[0]=v;}else{u=r.processTodoResponse(z);}u&&u[0]&&e.updateTodo(u[0]);}if(s===undefined){for(x in g){y=e.getTodo(g[x].todo.uid);y.set("sortOrder",g[x].todo.sortOrder);if(y.get("folderId")!==g[x].todo.folderId){w={uid:y.get("uid"),folderId:g[x].todo.folderId,oldFolderId:y.get("folder").get("id")};}y.set("folder",e.getFolder(g[x].todo.folderId));}r.fire("datamodel:updateTodo",{action:"updateData",folderChange:w});return;}if(m[0]){v=r.getTodo(g[0].todo.uid).clone();for(x in g[0].todo){if(x==="folderId"){v.set("folder",r.getFolders({id:g[0].todo[x]})[0]);}else{if(x=="dueOn"){v.set("dueOn",A(g[0].todo[x]));}else{v.set(x,g[0].todo[x]);}}}u=[];u[0]=v;}else{u=r.processTodoResponse(z);}if(u[0]){B=e.updateTodo(u[0]);if(s===undefined){return;}if(B.changeFolder){r.fire("datamodel:updateTodo",{targetNode:s.targetNode,action:"delete",change:B});r.fire("datamodel:updateTodo",{action:"add",uid:s.uid,change:{notDone:"update",done:null},targetNode:s.targetNode});return;}if(B.notDone){switch(B.notDone){case"update":r.fire("datamodel:updateTodo",{targetNode:s.targetNode,action:"update",uid:s.uid,change:B});break;case"delete":r.fire("datamodel:updateTodo",{targetNode:s.targetNode,action:"delete",change:B});break;case"add-hidden":r.fire("datamodel:todosAvailable","allNotDone");break;default:break;}}if(B.done){switch(B.done){case"update":r.fire("datamodel:updateTodo",{targetNode:s.targetNode,action:"update",uid:s.uid,change:B});break;case"delete":r.fire("datamodel:updateTodo",{targetNode:s.targetNode,action:"delete",change:B});break;case"add-hidden":r.fire("datamodel:todosAvailable","done");break;default:break;}}}},failure:function(i){b.addCounter("Error:updateTodo");r.handleAPIError(i);l&&l.failure&&l.failure(i);}},{folderMoveInfo:m});},deleteTodo:function(l,g){var m=this,k=l.data,j=l.target,i=m.getTodo(k.uid),h=i.get("folder");d.deleteTodo(k,{success:function(){var n;if(g){g(k.uid);e.deleteTodo(k);f.fire("datamodel:searchEventsAvailable");return;}n=e.deleteTodo(k);if(n==="allNotDone"){m.fire("datamodel:updateTodo",{targetNode:j.targetNode,action:"delete",change:{notDone:"delete",done:null}});}else{m.fire("datamodel:updateTodo",{targetNode:j.targetNode,action:"delete",change:{notDone:null,done:"delete"}});}},failure:function(n){b.addCounter("Error:deleteTodo");m.handleAPIError(n);}},{fid:h.get("id")});},search:function(g,h){if(!Config.cfg.tardisSearchEnabled){this.old_search(g,h);return;}var j={dtstart:g.dtstart,dtend:g.dtend,st:g.query},k=this,i=false;d.searchEvents(j,{success:function(n){var m=k.processEventResponse(n),l=k.processTodoResponse(n),o=true;e.storeSearchResults({events:m,dtstart:j.dtstart,dtend:j.dtend});e.storeSearchResults({todos:l,dtstart:j.dtstart,dtend:j.dtend});e.storeSearchResults("MERGE");f.fire("datamodel:searchEventsAvailable",{newSearch:true,view:h});},failure:function(l){b.addCounter("Error:searchEvents");k.handleAPIError(l);}});},old_search:function(g,h){var j={dtstart:g.dtstart,dtend:g.dtend,st:g.query},k=this,i=false;d.getEvents(j,{success:function(m){var l=k.processEventResponse(m),n=true;e.storeSearchResults({events:l,dtstart:j.dtstart,dtend:j.dtend});if(i){e.storeSearchResults("MERGE");f.fire("datamodel:searchEventsAvailable",{newSearch:true,view:h});}else{i=true;}},failure:function(l){b.addCounter("Error:searchEvents");k.handleAPIError(l);}});d.getTodos(j,{success:function(m){var l;m.isSearch=true;l=k.processTodoResponse(m);if(l){e.storeSearchResults({todos:l,dtstart:j.dtstart,dtend:j.dtend});if(i){e.storeSearchResults("MERGE");f.fire("datamodel:searchEventsAvailable",{newSearch:true,view:h});}else{i=true;}}},failure:function(l){b.addCounter("Error:searchTodos");k.handleAPIError(l);}});},getSearchResults:function(g,h){return e.getSearchResults(g,h);},getSearchMetaData:function(g){return e.getSearchResults(g,null);},fetchSharedCalendars:function(i){var j=this,h=null,g;if(i!==null){g=false;h=e.getSharedCalendars(i);}else{if(i===null){h=e.getSharedCalendars(Config.holidayAccount);i=Config.holidayAccount;g=true;}}if(h===null){d.getSharedCalendars(f.lib.Utils.getYIDFromEmailAddress(i),{success:function(l,k){if(k===0){j.fire("datamodel:calOpError",{errorCode:"noCalendarsAvailable"});}else{e.storeSharedCalendars(l,i);if(g){j.fire("datamodel:holidayCalendarsAvailable");}else{j.fire("datamodel:friendsCalendarsAvailable");}}},failure:function(k){if(g){j.handleAPIError(k);}else{j.fire("datamodel:calOpError",{errorCode:"wrongUserName"});}b.addCounter("Error:fetchSharedCalendars");}});}else{if(g){j.fire("datamodel:holidayCalendarsAvailable");}else{j.fire("datamodel:friendsCalendarsAvailable");}}},getRecurringEvents:function(j,g){var n=this,o=j.uid,k=j.fid,h,i,m,l;h=n.get("currentDate");if(n.get("currentView")==="week"||n.get("currentView")==="day"){i=h.getFirstDayOfWeekView(Prefs.weekStart).clearTime().addDays(-1);m=h.getLastDayOfWeekView(Prefs.weekStart).clearTime().addDays(1);}else{i=h.getFirstDayOfMonthView(Prefs.weekStart).clearTime();m=h.getLastDayOfMonthView(Prefs.weekStart).clearTime();}l=true;if(g&&Config.cfg.isCorp){l=false;}d.getEvents({dtstart:i,dtend:m,uids:o,fid:k,detail:l},{success:function(t){var r,q,p,s;if(!l){for(q=0;q<t.events.length;q++){t.events[q].description=g.get("description");t.events[q].organiser=g.get("organiser");t.events[q].attendees=g.get("attendees");t.events[q].recurrence=g.get("recurrence");}}r=n.processEventResponse(t);e.clearEventStore(null,i.addDays(-1));e.clearEventStore(m.addDays(1),null);for(q=0;q<r.length;q++){p=r[q];e.addEvent(p);}if(r&&r.length){s=r[0];}n.fire("datamodel:eventsAvailable",s);},failure:function(p){b.addCounter("Error:getEventsRecurring");n.handleAPIError(p);}});},getSharedCalendars:function(g){if(g===null){return e.getSharedCalendars(Config.holidayAccount);}else{return e.getSharedCalendars(g);}},getFreeBusy:function(h){var i=this,g=d.getFreeBusy(h,{success:function(k,j){i.fire("datamodel:fbAvailable",{user:j,data:k,access:true});},failure:function(k,j){i.fire("datamodel:fbAvailable",{user:j,data:{},access:false});}});return g;},getFreeBusyStatus:function(h){var i=this,g=d.getFreeBusyStatus(h,{success:function(j){i.fire("datamodel:fbStatusAvailable",j);}});return g;},getMailUserData:function(){var i=this,g,h=e.getMailUserData();if(h){i.fire("datamodel:mailUserDataAvailable",h);return null;}g=d.getMailUserData({success:function(j){e.setMailUserData(j.responseText);i.fire("datamodel:mailUserDataAvailable",e.getMailUserData());}});return g;},getWeather:function(){var i=this,g,h=e.getWeather();if(!Config.cfg.weatherEnabled){i.fire("datamodel:weatherAvailable",null);return null;}if(h){i.fire("datamodel:weatherAvailable",h);return null;}g=d.getWeather({success:function(j){e.setWeather(j.responseText);i.fire("datamodel:weatherAvailable",e.getWeather());}});return g;},changeUnits:function(){var g=this;e.changeWeatherUnits();g.fire("datamodel:weatherAvailable",e.getWeather());},getCalendarTheme:function(i){var h=this,g=d.getCalendarTheme(i,{success:function(j){h.fire("datamodel:calThemeAvailable",j);}});return g;},searchInterestingCals:function(i){var k=this,h,j=i,g;g=d.searchInterestingCals(i,{success:function(l){l.requestObj=j;if(i.cb&&i.cb.success){i.cb.success(l);}else{k.fire("datamodel:interestingCalendarsAvaialable",l);}},failure:function(l){k.handleAPIError(l);if(i.cb&&i.cb.failure){i.cb.failure(l);}else{k.fire("datamodel:intCalsFail",l);}}});return g;},getUpcomingSports:function(k){var n=this,i,h="",j,m=k,g,k,l;j=k&&e.getInterestingCalendar(k.dUrl);if(j){j.requestObj=m;n.fire("datamodel:upComingAvailable",j);return;}i=e.getSearchTags();l=e.getWeather();k.locationName=(l&&l.locationName)||"";h=i&&i.stHash;d.getSportsSearchTags({success:function(o){o.requestObj=m;if(o.responseText.searchTags&&o.responseText.searchTags.tagsArr.length){e.setSearchTags(o.responseText.searchTags);}f.fire("datamodel:intCalSearchTagsAvailable",{searchTags:e.getSearchTags()});}},h);g=d.getUpcomingSports(k,{success:function(o){o.requestObj=m;e.setInterestingCalendar(k.dUrl,o);n.fire("datamodel:upComingAvailable",o);},failure:function(o){n.handleAPIError(o);n.fire("datamodel:intCalsFail",o);}});return g;},getInterestingCalendars:function(i){var k=this,h,j=i,g;h=i&&e.getInterestingCalendar(i.pth);if(h){k.fire("datamodel:interestingCalendarsAvaialable",h);return;}g=d.getInterestingCalendars(i,{success:function(l){l.requestObj=j;e.setInterestingCalendar(i.pth,l);k.fire("datamodel:interestingCalendarsAvaialable",l);},failure:function(l){k.handleAPIError(l);k.fire("datamodel:intCalsFail",l);}});return g;},getGroupsDiscoveryData:function(j,g){var k=this,i,h=d;if(Config.cfg.isCorp){h=f.calendar.model.calServiceTardis;}h.getGroupsDiscoveryData(j,{success:function(l){l=k.processGroupsDiscoveryData(l);g.success(l);return;},failure:function(l){k.handleAPIError(l);g.failure();}});},processGroupsDiscoveryData:function(l){var m=this,l=l.responseText,k=[],j;if(l.discovered&&l.discovered.ts){for(j in l.discovered.ts){var h=l.discovered.ts[j];if(h.aId&&(h.aId.search("@@group")===0)&&(h.trT==="f")){var g=(h.as&&h.as.source&&h.as.source.subscribed)?h.as.source.subscribed[0]:null;k.push({eId:h.aId.split("#")[0],eFid:h.fid,mount:g,dN:h.as.dN});}}}return k;},getOptions:function(g){var i=this,h={};if(e.hasOptions()){h=e.getOptions();if(g){g(h);}else{i.fire("datamodel:OptionsAvailable",h);}}else{d.getOptions({},{success:function(j){e.storeOptions(j);if(g){g(j);}else{i.fire("datamodel:OptionsAvailable",j);}},failure:function(j){b.addCounter("Error:getOptions");i.handleAPIError(j);}});}},getGrpOptions:function(g){var i=this,h={};if(e.hasGrpOptions()){h=e.getGrpOptions();if(g){g(h);}else{i.fire("datamodel:GrpOptionsAvailable",h);}}else{d.getGrpOptions({},{success:function(j){e.storeGrpOptions(j);if(g){g(j);}else{i.fire("datamodel:GrpOptionsAvailable",j);}},failure:function(j){b.addCounter("Error:getGrpOptions");i.handleAPIError(j);}});}},updateOptions:function(h,g){var j=this,i;e.storeOptions();i=f.clone(h,true);i.options=i.Options;d.updateOptions(h,{success:function(){e.storeOptions(i);g.success();}});},updateGrpOptions:function(h,g){var j=this,i;e.storeGrpOptions();i=f.clone(h,true);i.options=i.Options;d.updateGrpOptions(h,{success:function(){e.storeGrpOptions(i);g.success();}});},getInviteDetails:function(i,k,j,g){var l=this,h;if(!g){h=e.getEventsByUID(i);if(h){if(Config.yid!=null){l.getEventDetails({uid:i,recurId:k.recurid?k.recurid:null},{success:function(m){j.success(h[0],m);},failure:function(m){j.success(h[0],null);}},{dontHandleError:true});}else{j.success(h[0],null);}}else{j.failure();}return;}d.getInviteDetails({uid:i,fid:k.fid,recurId:k.recurid,owner:g},{success:function(m){m.ignoreFolder=true;h=l.processEventResponse(m);if(h.length>0){j.success(h[0]);}},failure:function(m){j.failure&&j.failure();}});},replyRSVP:function(h,j,g,i){var k=this;d.replyRSVP({uid:h,recurid:j},{invite:g},{success:function(r){var o,p,n,m,l,s,q;if(g.partStat&&g.partStat=="DECLINED"){if(Config.cfg.isCorp){q=k.processEventResponse({events:[r.responseText.invite]})[0];if(!q.get("isException")&&q.get("isRecurring")){e.removeEventsByExId(q.get("ICalExchangeId"));}else{e.removeEvent(h);}}else{if(!j){e.removeEvent(h);}}}else{if(Config.cfg.isCorp){q=k.processEventResponse({events:[r.responseText.invite]})[0];if(!q.get("isException")&&q.get("isRecurring")){e.removeEventsByExId(q.get("ICalExchangeId"));k.getRecurringEvents({uid:q.get("uid"),fid:q.get("folder").get("id")},q);}else{e.removeEvent(h);e.addEvent(q);}}else{q=k.processEventResponse({events:[r.responseText.invite]})[0];o=e.getEventsByUID(h);p=e.getFolder(g.folderId);for(n=0;n<o.length;n++){o[n].set("reminders",g.reminders);o[n].set("folder",p);o[n].set("attendees",q.get("attendees"));o[n].set("status",q.get("status"));}}}k.fire("datamodel:eventsAvailable");i.success();},failure:function(l){i.failure&&i.failure();k.handleAPIError(l);}});},updateRSVP:function(j,h,g,l,k){var m=this,i;d.updateRSVP({uid:j,recurId:h,organizer:g},l,{success:function(n){k.success();},failure:function(n){k.failure&&k.failure();}});},updateTimezone:function(j,i){var h=this,g;if(!Config.yid){return;}g=function(m){var k=m,l={Options:k.options};l.Options.timeZoneId=j;Prefs.timezone=j;h.updateOptions(l,{success:function(){if(i){i();}},failure:function(){if(i){i();}}});};h.getOptions(g);},makeViewSticky:function(j){var i=this,h,g;if(Config.owner||!Config.yid||j==="year"||j==="options"||j=="reminderOptions"||j==="notepad"){return;}if(Config.cfg.isCorp&&j=="list"){return;}g=function(k){h=k,optionsObj={Options:h.options};optionsObj.Options.defaultView=j;Prefs.initialView=j;i.updateOptions(optionsObj,{success:function(){},failure:function(){}});};i.getOptions(g);},makeTodoViewSticky:function(j){var i=this,h,g;g=function(k){h=k,optionsObj={Options:h.options};optionsObj.Options.todoView=j;Prefs.todoView=j;i.updateOptions(optionsObj,{success:function(){},failure:function(){}});};i.getOptions(g);},showToast:function(g){var h=f.one("#shellcontent");if(!g){g="loading";}else{g="save";}if(h){f.use("lib-ui-toast",function(i){i.lib.ui.toast.show(g,h);});}},getNotes:function(h){var i=this,g;if(h.uid&&(h.uid==="new-note")){return new f.calendar.notepad.model.Note({uid:"new-note"});}g=e.getNotes(h);if(h.fid){if(h.fid==="search"){return e.getNoteSearchResults();}else{if(!g&&!e.getNotes({fid:"all"})){i.showToast();d.getJournals({fid:h.fid},{success:function(k){var j;if(k.responseText.RESPONSE["CODE"]!==0){i.handleAPIError(k);}else{if(k.responseText.RESPONSE.VALUE){j=i.processNoteResponse(k.responseText.RESPONSE.VALUE);e.storeNotes(j,[h.fid]);i.fire("datamodel:notesAvailable");}else{i.handleAPIError(k);}}},failure:function(j){i.handleAPIError(j);}});}else{return g;}}}else{return g;}},updateNote:function(l,g){var n=this,i={},k=(l.fid)?true:false,h=(n.get("selectedNoteFolder")==="search"),m;if(l.uid==="new-note"){n.addNote(l,g);return;}l.summary&&(l.summary=l.summary.replace(/\/|\"|\:/g,""));if(f.Lang.trim(l.summary)===""){return;}if(Config.isTardisEnabled){i.journal={};l.summary&&(i.journal.summary=l.summary);l.description&&(i.journal.description=l.description);var j=e.getNotes({uid:l.uid});if(k){l.folderNew=l.fid;}l.folderId=j.get("folder").get("id");l.folderId&&(i.journal.folderId=l.folderId);}else{l.summary&&(i.SUMMARY=l.summary);l.description&&(i.DESCRIPTION=l.description);}m=n.checkIfNameAlreadyUsed(l.summary,l.uid);if(m){n.fire("datamodel:APIError","SAME_FOLDER_NAME");g&&g.failure&&g.failure();return;}n.showToast("save");d.updateNote(i,l,{success:function(q){var p;if(q.responseText.RESPONSE.CODE!==0){n.handleAPIError(q);}else{p=n.processNoteResponse([q.responseText.RESPONSE.VALUE]);e.updateNote(p[0],k);if(h){e.updateNoteSearchResults(p[0]);}n.fire("datamodel:notesAvailable");g&&g.success();}},failure:function(p){n.handleAPIError(p);g&&g.failure();}});},addNote:function(i,g){var k=this,h={},j;if(!i.folderId){i.folderId=k.get("selectedNoteFolder");}if(i.folderId==="search"){i.folderId="12";}i.summary&&(i.summary=i.summary.replace(/\/|\"|\:/g,""));if(f.Lang.trim(i.summary)===""){return;}if(Config.isTardisEnabled){h.journal={};i.summary&&(h.journal.summary=i.summary);i.description&&(h.journal.description=i.description);i.folderId&&(h.journal.folderId=i.folderId);}else{i.summary&&(h.SUMMARY=i.summary);i.description&&(h.DESCRIPTION=i.description);}j=k.checkIfNameAlreadyUsed(i.summary);if(j){k.fire("datamodel:APIError","SAME_FOLDER_NAME");return;}k.showToast("save");d.addNote(h,i,{success:function(m){var l;if(m.responseText.RESPONSE.CODE!==0){k.handleAPIError(m);}else{if(Config.isTardisEnabled){l=k.processNoteResponse([m.responseText.journal]);}else{l=k.processNoteResponse([m.responseText.RESPONSE.VALUE]);}e.addNote(l[0]);g&&g.success(l[0]);k.fire("datamodel:notesAvailable");}},failure:function(l){k.handleAPIError(l);g&&g.failure();}});},deleteNote:function(j,g){var k=this,h=(k.get("selectedNoteFolder")==="search");k.showToast("deleting");var i=e.getNotes({uid:j.uid});j.folderId=i.get("folder").get("id");d.deleteNote(j,{success:function(l){if(l.responseText.RESPONSE.CODE!==0){k.handleAPIError(l);}else{if(h){e.updateNoteSearchResults(notes[0],{mode:"DELETE",uid:j.uid});}e.deleteNote(j.uid);k.fire("datamodel:notesAvailable");g&&g.success();}},failure:function(l){k.handleAPIError(l);g&&g.failure();}});},processNoteResponse:function(j){var l=this,k,g=[],h;for(h in j){k=new f.calendar.notepad.model.Note(j[h]);k.set("folder",l.getFolders({id:j[h].FOLDER_ID||j[h].folderId})[0]);g.push(k);}return g;},convertFolderV1toV2:function(g){var h={};h.id=g.FOLDER_ID+"";h.type=g.FOLDER_TYPE;h.name=g.FOLDER_NAME;return h;},searchNotes:function(h){var i=this,g=(Config.cfg.tardisSearchEnabled)?f.calendar.model.calServiceTardis:f.calendar.model.calService;f.lib.utils.Stats.stampPage("1197727027");i.showToast();g.searchNotes(h,{success:function(j){if(j.responseText.RESPONSE["CODE"]!==0){i.handleAPIError(j);}else{if(j.responseText.RESPONSE.VALUE){notes=i.processNoteResponse(j.responseText.RESPONSE.VALUE);e.storeNoteSearchResults(notes);i.set("selectedNoteFolder","search");i.fire("datamodel:searchNotesAvailable");}else{i.handleAPIError(j);}}},failure:function(j){i.handleAPIError(j);cb&&cb.failure();}});},checkIfNameAlreadyUsed:function(g,n){var m=this,j=m.getFolders(),h,l=false,k;for(h in j){if((g===j[h].get("name"))&&((n!==j[h].get("id"))||!n)){l=true;break;}}if(Config.product==="notepad"){k=e.getNotes({summary:g});if(k&&(!n||(n!==k.get("uid")))){l=true;}}return l;},getAlternateFolderName:function(g){var j=this,h=1;while(j.checkIfNameAlreadyUsed(g)){g=g+"("+h+++")";}return g;},getConfRooms:function(){return e.getConfRooms();},storeConfRooms:function(){e.storeConfRooms();},updatePromotionKey:function(g,h){var i=this;if(i.featurePromoter){i.featurePromoter.updatePromoStatus(g,h);}}};f.namespace("calendar.model");f.calendar.model.dataModel=new a(Config.args.date);},"1.0.0",{requires:["calendar-model-event","calendar-model-event-tardis","calendar-model-todo","calendar-model-calservice","calendar-model-calservice-tardis","calendar-model-datastore","lib-utils-date","lib-utils-stats","calendar-model-folder","lib-utils","lib-utils-errorHandler","lib-net","calendar-model-plugin-autorefresh","calendar-notepad-model-note"]});